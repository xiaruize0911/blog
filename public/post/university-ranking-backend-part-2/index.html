<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>University Ranking Backend: Code Deep Dive (Part 2) | xiaruize's Blog</title><meta name=keywords content="Python,Flask,Backend,Code Analysis,Data Engineering"><meta name=description content="In Part 1, we explored the core search logic and API structure. In this second part, we&rsquo;ll dig into the Data Layer‚Äîhow data is normalized, stored, and retrieved in detail. We&rsquo;ll also look at the utility scripts that power the backend&rsquo;s intelligence.
1. The Data &ldquo;Glue&rdquo;: utils/normalize_name.py
One of the biggest challenges in aggregating data from multiple sources (QS, US News, Niche) is that they all name universities differently. &ldquo;MIT&rdquo; might be &ldquo;Massachusetts Institute of Technology&rdquo; in one dataset and &ldquo;Mass Inst of Tech&rdquo; in another."><meta name=author content><link rel=canonical href=https://xiaruize.org/post/university-ranking-backend-part-2/><link crossorigin=anonymous href=/assets/css/stylesheet.e1f5c4cae44599655f7ff95195ff89c8cb3adbda94f2b1581a434ab2b4d4e6cf.css integrity="sha256-4fXEyuRFmWVff/lRlf+JyMs629qU8rFYGkNKsrTU5s8=" rel="preload stylesheet" as=style><link rel=icon href=https://xiaruize.org/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://xiaruize.org/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://xiaruize.org/favicon-32x32.png><link rel=apple-touch-icon href=https://xiaruize.org/apple-touch-icon.png><link rel=mask-icon href=https://xiaruize.org/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://xiaruize.org/post/university-ranking-backend-part-2/><link rel=alternate hreflang=zh href=https://xiaruize.org/zh/post/university-ranking-backend-part-2/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://xiaruize.org/post/university-ranking-backend-part-2/"><meta property="og:site_name" content="xiaruize's Blog"><meta property="og:title" content="University Ranking Backend: Code Deep Dive (Part 2)"><meta property="og:description" content="In Part 1, we explored the core search logic and API structure. In this second part, we‚Äôll dig into the Data Layer‚Äîhow data is normalized, stored, and retrieved in detail. We‚Äôll also look at the utility scripts that power the backend‚Äôs intelligence.
1. The Data ‚ÄúGlue‚Äù: utils/normalize_name.py One of the biggest challenges in aggregating data from multiple sources (QS, US News, Niche) is that they all name universities differently. ‚ÄúMIT‚Äù might be ‚ÄúMassachusetts Institute of Technology‚Äù in one dataset and ‚ÄúMass Inst of Tech‚Äù in another."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2025-12-07T00:00:00+00:00"><meta property="article:modified_time" content="2025-12-07T00:00:00+00:00"><meta property="article:tag" content="Python"><meta property="article:tag" content="Flask"><meta property="article:tag" content="Backend"><meta property="article:tag" content="Code Analysis"><meta property="article:tag" content="Data Engineering"><meta name=twitter:card content="summary"><meta name=twitter:title content="University Ranking Backend: Code Deep Dive (Part 2)"><meta name=twitter:description content="In Part 1, we explored the core search logic and API structure. In this second part, we&rsquo;ll dig into the Data Layer‚Äîhow data is normalized, stored, and retrieved in detail. We&rsquo;ll also look at the utility scripts that power the backend&rsquo;s intelligence.
1. The Data &ldquo;Glue&rdquo;: utils/normalize_name.py
One of the biggest challenges in aggregating data from multiple sources (QS, US News, Niche) is that they all name universities differently. &ldquo;MIT&rdquo; might be &ldquo;Massachusetts Institute of Technology&rdquo; in one dataset and &ldquo;Mass Inst of Tech&rdquo; in another."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://xiaruize.org/post/"},{"@type":"ListItem","position":2,"name":"University Ranking Backend: Code Deep Dive (Part 2)","item":"https://xiaruize.org/post/university-ranking-backend-part-2/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"University Ranking Backend: Code Deep Dive (Part 2)","name":"University Ranking Backend: Code Deep Dive (Part 2)","description":"In Part 1, we explored the core search logic and API structure. In this second part, we\u0026rsquo;ll dig into the Data Layer‚Äîhow data is normalized, stored, and retrieved in detail. We\u0026rsquo;ll also look at the utility scripts that power the backend\u0026rsquo;s intelligence.\n1. The Data \u0026ldquo;Glue\u0026rdquo;: utils/normalize_name.py One of the biggest challenges in aggregating data from multiple sources (QS, US News, Niche) is that they all name universities differently. \u0026ldquo;MIT\u0026rdquo; might be \u0026ldquo;Massachusetts Institute of Technology\u0026rdquo; in one dataset and \u0026ldquo;Mass Inst of Tech\u0026rdquo; in another.\n","keywords":["Python","Flask","Backend","Code Analysis","Data Engineering"],"articleBody":"In Part 1, we explored the core search logic and API structure. In this second part, we‚Äôll dig into the Data Layer‚Äîhow data is normalized, stored, and retrieved in detail. We‚Äôll also look at the utility scripts that power the backend‚Äôs intelligence.\n1. The Data ‚ÄúGlue‚Äù: utils/normalize_name.py One of the biggest challenges in aggregating data from multiple sources (QS, US News, Niche) is that they all name universities differently. ‚ÄúMIT‚Äù might be ‚ÄúMassachusetts Institute of Technology‚Äù in one dataset and ‚ÄúMass Inst of Tech‚Äù in another.\nThis file contains the logic to standardize names so we can link data together.\nFunction: normalize_name Input: name (string), e.g., ‚ÄúUniversity of California, Berkeley (UCB)‚Äù. Logic: Lowercase: Converts everything to lowercase to avoid case mismatches. Clean Up: Removes text in parentheses (like abbreviations) and punctuation. Alias Check: It checks a dictionary of known aliases (ALIASES). If the input is ‚Äúmit‚Äù, it automatically converts it to ‚Äúmassachusetts institute of technology‚Äù. Output: A clean, standardized string (e.g., ‚Äúuniversity of california berkeley‚Äù). def normalize_name(name: str) -\u003e str: # Lowercase name = name.lower() # Remove text in parentheses, like \"(MIT)\" name = re.sub(r'\\(.*?\\)', '', name) # Remove punctuation name = re.sub(r'[^\\w\\s]', '', name) # Normalize spaces name = re.sub(r'\\s+', ' ', name) if name in ALIASES: # If the name is an alias, replace it with the full name name = ALIASES[name] return name.strip() 2. Detailed Profile Logic: models/university.py While models/universities.py (plural) handles lists and searching, this file handles the deep dive into a single university‚Äôs profile.\nFunction: get_university_by_id This function is interesting because it has to gather data from many different tables to build a complete profile.\nInput: univ_id (integer). Logic: Basic Info: Fetches the main details (name, location, photo) from the Universities table. Translation: Joins with University_names_en_to_zh to get the Chinese name. Dynamic Ranking Retrieval: It queries sqlite_master to find all tables in the database that end with _Rankings. It loops through every single ranking table and checks if this university is listed there. This allows the system to be easily extensible‚Äîif you add a new ranking table (e.g., ‚ÄúMars_University_Rankings‚Äù), this function automatically picks it up without code changes. Stats: Fetches statistical data (student count, etc.) from UniversityStats. Output: A massive dictionary containing everything known about that university. def get_university_by_id(univ_id): conn = get_db_connection() # Step 1: Get university basic info cur = conn.execute(\"\"\" SELECT Universities.*, T.chinese_name FROM Universities LEFT JOIN University_names_en_to_zh AS T ON Universities.id = T.id WHERE Universities.id = ? \"\"\", (univ_id,)) row = cur.fetchone() if not row: return None university = dict(row) normalized_name = university['normalized_name'] # Step 2: Get rankings from all *_Rankings tables cur = conn.execute(\"SELECT name FROM sqlite_master WHERE type='table' AND name LIKE '%_Rankings'\") ranking_tables = [r[\"name\"] for r in cur.fetchall()] rankings = [] for table in ranking_tables: try: cur = conn.execute( f\"\"\"SELECT subject, source, rank_value FROM \"{table}\" WHERE normalized_name = ?\"\"\", (normalized_name,) ) rankings += [dict(r) for r in cur.fetchall()] except Exception as e: # Skip malformed or mismatched tables continue # Step 3: Get stats from UniversityStats cur = conn.execute( \"SELECT type, count, year FROM UniversityStats WHERE normalized_name = ?\", (normalized_name,) ) stats = [dict(r) for r in cur.fetchall()] conn.close() rankings = sorted(rankings, key= lambda x: -1 if \"global\" in x[\"subject\"] or \"World\" in x[\"subject\"] else x[\"rank_value\"]) # Combine everything university[\"rankings\"] = rankings university[\"stats\"] = stats return university 3. Subject Rankings: routes/ranking_detail.py This route handles specific subject rankings, like ‚ÄúComputer Science‚Äù or ‚ÄúMedicine‚Äù.\nFunction: ranking_detail (GET /subject_rankings/ranking_detail) Input: Query parameters table, source, and subject. Logic: Validates that all three parameters are present. Calls get_ranking_detail (from models.ranking_options) to fetch the specific list. This is used when a user wants to see the full list of rankings for a specific category, rather than just one university‚Äôs position. Output: A JSON list of universities ranked in that specific subject. @ranking_detail_bp.route('/ranking_detail', methods=['GET']) def ranking_detail(): table = request.args.get('table') source = request.args.get('source') subject = request.args.get('subject') print(f'ranking_detail {{\"table\": \"{table}\", \"source\": \"{source}\", \"subject\": \"{subject}\"}}') if not table or not source or not subject: return jsonify({'error': 'Missing parameters'}), 400 detail = get_ranking_detail(table, source, subject) return jsonify(detail) 4. The Database Connection: db/database.py A simple but essential utility.\nFunction: get_db_connection Input: None. Logic: Connects to the SQLite file defined in config.DATABASE. Sets conn.row_factory = sqlite3.Row. This is a pro tip for Flask/SQLite developers: it allows you to access database rows like dictionaries (e.g., row['name']) instead of just tuples (e.g., row[1]). Output: An active database connection object. def get_db_connection(): conn = sqlite3.connect(DATABASE) conn.row_factory = sqlite3.Row return conn 5. Data Ingestion: scripts/data_to_db_universities.py How does data get into the system? This script shows the ETL (Extract, Transform, Load) process.\nScript Logic Extract: Reads a raw CSV file (data/merged_data.csv) using Pandas. Transform: Selects only the columns we need (Name, Country, City, etc.). Renames columns to match our SQL schema (e.g., Name -\u003e name). Load: Connects to the SQLite database. Iterates through the Pandas DataFrame. Executes an INSERT SQL command for every row. Result: Populates the Universities table, which serves as the backbone for the entire application. # Load the new CSV df = pd.read_csv(\"data/merged_data.csv\") # Select and rename required columns df = df[[ \"Name\", \"normalizedName\", \"Country\", \"Country Code\", \"City\", \"Photo\", \"Blurb\" ]].copy() # Rename to match SQL table df.columns = [ \"name\", \"normalized_name\", \"country\", \"country_code\", \"city\", \"photo\", \"blurb\" ] # Connect to SQLite database conn = sqlite3.connect(\"University_rankings.db\") cursor = conn.cursor() # Insert rows for _, row in df.iterrows(): cursor.execute(\"\"\" INSERT INTO Universities ( normalized_name, name, country, country_code, city, photo, blurb ) VALUES (?, ?, ?, ?, ?, ?, ?) \"\"\", ( row[\"normalized_name\"], row[\"name\"], row[\"country\"], row[\"country_code\"], row[\"city\"], row[\"photo\"], row[\"blurb\"] )) # Commit and close conn.commit() conn.close() üåä The Vibe Coding Perspective How does Vibe Coding (AI-assisted coding) apply to data engineering and scripts? It‚Äôs about using AI to quickly prototype solutions, validate assumptions, and refactor code while maintaining high quality and extensibility.\nDynamic Discovery: In get_university_by_id, we loop through all tables ending in _Rankings. We didn‚Äôt create a complex RankingRegistry class or a configuration file. We just let the database tell us what it has.\nAI-Assisted Architecture: With AI guidance, we identified this simpler approach over more complex alternatives. It‚Äôs loose, flexible, and incredibly easy to extend. You don‚Äôt have to ‚Äúregister‚Äù a new dataset; you just load it. The AI helped us avoid over-engineering. Pragmatic Normalization: The normalize_name function isn‚Äôt using a complex NLP model or fuzzy matching library. It uses a simple dictionary (ALIASES) and some regex.\nAI-Assisted Trade-offs: The AI helped us decide to use simple regex and aliasing rather than complex NLP, recognizing that it solves 99% of the problem with 1% of the effort. When using AI-assisted coding, you focus on the specific data issues you see (like ‚ÄúMIT‚Äù vs ‚ÄúMassachusetts Institute of Technology‚Äù), let the AI handle boilerplate and common patterns, and move on to more interesting problems. Conclusion The University Ranking Backend demonstrates how to build a flexible, data-driven API. By separating the ‚Äúnormalization‚Äù logic into utilities and using dynamic SQL queries to discover tables, the system can handle new ranking data with minimal code changes.\nIn the next part, we might explore how to deploy this system or how the frontend consumes this API!\n","wordCount":"1176","inLanguage":"en","datePublished":"2025-12-07T00:00:00Z","dateModified":"2025-12-07T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://xiaruize.org/post/university-ranking-backend-part-2/"},"publisher":{"@type":"Organization","name":"xiaruize's Blog","logo":{"@type":"ImageObject","url":"https://xiaruize.org/favicon.ico"}}}</script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.css integrity=sha384-zh0CIslj+VczCZtlzBcjt5ppRcsAmDnRem7ESsYwWwg3m/OaJ2l4x7YBZl9Kxxib crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.js integrity=sha384-Rma6DA2IPUwhNxmrB/7S3Tno0YY7sFu9WSYMCuulLhIqYSGZ2gKCJWIqhBWqMQfh crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/contrib/auto-render.min.js integrity=sha384-hCXGrW6PitJEwbkoStFjeJxv+fSOOQKOPbJxSfM6G5sWZjAyWhXiTIIAmQqnlLlh crossorigin=anonymous onload=renderMathInElement(document.body)></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"\\[",right:"\\]",display:!0},{left:"$$",right:"$$",display:!0},{left:"\\(",right:"\\)",display:!1},{left:"$",right:"$",display:!1}],throwOnError:!0})})</script></head><body id="
    top"><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://xiaruize.org/ accesskey=h title="xiaruize's Blog (Alt + H)">xiaruize's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://xiaruize.org/zh/ title=‰∏≠Êñá aria-label=‰∏≠Êñá>Zh</a></li></ul></div></div><ul id=menu><li><a href=https://xiaruize.org/categories/ title=categories><span>categories</span></a></li><li><a href=https://xiaruize.org/tags/ title=tags><span>tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">University Ranking Backend: Code Deep Dive (Part 2)</h1><div class=post-meta><span title='2025-12-07 00:00:00 +0000 UTC'>December 7, 2025</span>&nbsp;|&nbsp;Translations:<ul class=i18n_list><li><a href=https://xiaruize.org/zh/post/university-ranking-backend-part-2/>Zh</a></li></ul></div></header><div class=post-content><p>In <a href=https://xiaruize.org/post/university-ranking-backend-part-1/>Part 1</a>, we explored the core search logic and API structure. In this second part, we&rsquo;ll dig into the <strong>Data Layer</strong>‚Äîhow data is normalized, stored, and retrieved in detail. We&rsquo;ll also look at the utility scripts that power the backend&rsquo;s intelligence.</p><h2 id=1-the-data-glue-utilsnormalize_namepy>1. The Data &ldquo;Glue&rdquo;: <code>utils/normalize_name.py</code><a hidden class=anchor aria-hidden=true href=#1-the-data-glue-utilsnormalize_namepy>#</a></h2><p>One of the biggest challenges in aggregating data from multiple sources (QS, US News, Niche) is that they all name universities differently. &ldquo;MIT&rdquo; might be &ldquo;Massachusetts Institute of Technology&rdquo; in one dataset and &ldquo;Mass Inst of Tech&rdquo; in another.</p><p>This file contains the logic to standardize names so we can link data together.</p><h3 id=function-normalize_name>Function: <code>normalize_name</code><a hidden class=anchor aria-hidden=true href=#function-normalize_name>#</a></h3><ul><li><strong>Input</strong>: <code>name</code> (string), e.g., &ldquo;University of California, Berkeley (UCB)&rdquo;.</li><li><strong>Logic</strong>:<ol><li><strong>Lowercase</strong>: Converts everything to lowercase to avoid case mismatches.</li><li><strong>Clean Up</strong>: Removes text in parentheses (like abbreviations) and punctuation.</li><li><strong>Alias Check</strong>: It checks a dictionary of known aliases (<code>ALIASES</code>). If the input is &ldquo;mit&rdquo;, it automatically converts it to &ldquo;massachusetts institute of technology&rdquo;.</li></ol></li><li><strong>Output</strong>: A clean, standardized string (e.g., &ldquo;university of california berkeley&rdquo;).</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>normalize_name</span><span class=p>(</span><span class=n>name</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># Lowercase</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span> <span class=o>=</span> <span class=n>name</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=c1># Remove text in parentheses, like &#34;(MIT)&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;\(.*?\)&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># Remove punctuation</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;[^\w\s]&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># Normalize spaces</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;\s+&#39;</span><span class=p>,</span> <span class=s1>&#39; &#39;</span><span class=p>,</span> <span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>name</span> <span class=ow>in</span> <span class=n>ALIASES</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># If the name is an alias, replace it with the full name</span>
</span></span><span class=line><span class=cl>        <span class=n>name</span> <span class=o>=</span> <span class=n>ALIASES</span><span class=p>[</span><span class=n>name</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>name</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span></span></code></pre></div><hr><h2 id=2-detailed-profile-logic-modelsuniversitypy>2. Detailed Profile Logic: <code>models/university.py</code><a hidden class=anchor aria-hidden=true href=#2-detailed-profile-logic-modelsuniversitypy>#</a></h2><p>While <code>models/universities.py</code> (plural) handles lists and searching, this file handles the deep dive into a <em>single</em> university&rsquo;s profile.</p><h3 id=function-get_university_by_id>Function: <code>get_university_by_id</code><a hidden class=anchor aria-hidden=true href=#function-get_university_by_id>#</a></h3><p>This function is interesting because it has to gather data from <em>many</em> different tables to build a complete profile.</p><ul><li><strong>Input</strong>: <code>univ_id</code> (integer).</li><li><strong>Logic</strong>:<ol><li><strong>Basic Info</strong>: Fetches the main details (name, location, photo) from the <code>Universities</code> table.</li><li><strong>Translation</strong>: Joins with <code>University_names_en_to_zh</code> to get the Chinese name.</li><li><strong>Dynamic Ranking Retrieval</strong>:<ul><li>It queries <code>sqlite_master</code> to find <em>all</em> tables in the database that end with <code>_Rankings</code>.</li><li>It loops through every single ranking table and checks if this university is listed there.</li><li>This allows the system to be easily extensible‚Äîif you add a new ranking table (e.g., &ldquo;Mars_University_Rankings&rdquo;), this function automatically picks it up without code changes.</li></ul></li><li><strong>Stats</strong>: Fetches statistical data (student count, etc.) from <code>UniversityStats</code>.</li></ol></li><li><strong>Output</strong>: A massive dictionary containing everything known about that university.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_university_by_id</span><span class=p>(</span><span class=n>univ_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span> <span class=o>=</span> <span class=n>get_db_connection</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># Step 1: Get university basic info</span>
</span></span><span class=line><span class=cl>    <span class=n>cur</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        SELECT Universities.*, T.chinese_name 
</span></span></span><span class=line><span class=cl><span class=s2>        FROM Universities 
</span></span></span><span class=line><span class=cl><span class=s2>        LEFT JOIN University_names_en_to_zh AS T ON Universities.id = T.id 
</span></span></span><span class=line><span class=cl><span class=s2>        WHERE Universities.id = ?
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span><span class=p>,</span> <span class=p>(</span><span class=n>univ_id</span><span class=p>,))</span>
</span></span><span class=line><span class=cl>    <span class=n>row</span> <span class=o>=</span> <span class=n>cur</span><span class=o>.</span><span class=n>fetchone</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>row</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>university</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>(</span><span class=n>row</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>normalized_name</span> <span class=o>=</span> <span class=n>university</span><span class=p>[</span><span class=s1>&#39;normalized_name&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Step 2: Get rankings from all *_Rankings tables</span>
</span></span><span class=line><span class=cl>    <span class=n>cur</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;SELECT name FROM sqlite_master WHERE type=&#39;table&#39; AND name LIKE &#39;%_Rankings&#39;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ranking_tables</span> <span class=o>=</span> <span class=p>[</span><span class=n>r</span><span class=p>[</span><span class=s2>&#34;name&#34;</span><span class=p>]</span> <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=n>cur</span><span class=o>.</span><span class=n>fetchall</span><span class=p>()]</span>
</span></span><span class=line><span class=cl>    <span class=n>rankings</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>table</span> <span class=ow>in</span> <span class=n>ranking_tables</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>cur</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=sa>f</span><span class=s2>&#34;&#34;&#34;SELECT subject, source, rank_value 
</span></span></span><span class=line><span class=cl><span class=s2>                    FROM &#34;</span><span class=si>{</span><span class=n>table</span><span class=si>}</span><span class=s2>&#34; WHERE normalized_name = ?&#34;&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=p>(</span><span class=n>normalized_name</span><span class=p>,)</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>rankings</span> <span class=o>+=</span> <span class=p>[</span><span class=nb>dict</span><span class=p>(</span><span class=n>r</span><span class=p>)</span> <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=n>cur</span><span class=o>.</span><span class=n>fetchall</span><span class=p>()]</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># Skip malformed or mismatched tables</span>
</span></span><span class=line><span class=cl>            <span class=k>continue</span>
</span></span><span class=line><span class=cl>    <span class=c1># Step 3: Get stats from UniversityStats</span>
</span></span><span class=line><span class=cl>    <span class=n>cur</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;SELECT type, count, year FROM UniversityStats WHERE normalized_name = ?&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=n>normalized_name</span><span class=p>,)</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>stats</span> <span class=o>=</span> <span class=p>[</span><span class=nb>dict</span><span class=p>(</span><span class=n>r</span><span class=p>)</span> <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=n>cur</span><span class=o>.</span><span class=n>fetchall</span><span class=p>()]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>conn</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>rankings</span> <span class=o>=</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>rankings</span><span class=p>,</span> <span class=n>key</span><span class=o>=</span> <span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=o>-</span><span class=mi>1</span> <span class=k>if</span> <span class=s2>&#34;global&#34;</span> <span class=ow>in</span> <span class=n>x</span><span class=p>[</span><span class=s2>&#34;subject&#34;</span><span class=p>]</span> <span class=ow>or</span> <span class=s2>&#34;World&#34;</span> <span class=ow>in</span> <span class=n>x</span><span class=p>[</span><span class=s2>&#34;subject&#34;</span><span class=p>]</span> <span class=k>else</span> <span class=n>x</span><span class=p>[</span><span class=s2>&#34;rank_value&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Combine everything</span>
</span></span><span class=line><span class=cl>    <span class=n>university</span><span class=p>[</span><span class=s2>&#34;rankings&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>rankings</span>
</span></span><span class=line><span class=cl>    <span class=n>university</span><span class=p>[</span><span class=s2>&#34;stats&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>stats</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>university</span>
</span></span></code></pre></div><hr><h2 id=3-subject-rankings-routesranking_detailpy>3. Subject Rankings: <code>routes/ranking_detail.py</code><a hidden class=anchor aria-hidden=true href=#3-subject-rankings-routesranking_detailpy>#</a></h2><p>This route handles specific subject rankings, like &ldquo;Computer Science&rdquo; or &ldquo;Medicine&rdquo;.</p><h3 id=function-ranking_detail-get-subject_rankingsranking_detail>Function: <code>ranking_detail</code> (<code>GET /subject_rankings/ranking_detail</code>)<a hidden class=anchor aria-hidden=true href=#function-ranking_detail-get-subject_rankingsranking_detail>#</a></h3><ul><li><strong>Input</strong>: Query parameters <code>table</code>, <code>source</code>, and <code>subject</code>.</li><li><strong>Logic</strong>:<ol><li>Validates that all three parameters are present.</li><li>Calls <code>get_ranking_detail</code> (from <code>models.ranking_options</code>) to fetch the specific list.</li><li>This is used when a user wants to see the full list of rankings for a specific category, rather than just one university&rsquo;s position.</li></ol></li><li><strong>Output</strong>: A JSON list of universities ranked in that specific subject.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@ranking_detail_bp.route</span><span class=p>(</span><span class=s1>&#39;/ranking_detail&#39;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;GET&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>ranking_detail</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>table</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;table&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>source</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;source&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>subject</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;subject&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;ranking_detail </span><span class=se>{{</span><span class=s1>&#34;table&#34;: &#34;</span><span class=si>{</span><span class=n>table</span><span class=si>}</span><span class=s1>&#34;, &#34;source&#34;: &#34;</span><span class=si>{</span><span class=n>source</span><span class=si>}</span><span class=s1>&#34;, &#34;subject&#34;: &#34;</span><span class=si>{</span><span class=n>subject</span><span class=si>}</span><span class=s1>&#34;</span><span class=se>}}</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>table</span> <span class=ow>or</span> <span class=ow>not</span> <span class=n>source</span> <span class=ow>or</span> <span class=ow>not</span> <span class=n>subject</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span><span class=s1>&#39;error&#39;</span><span class=p>:</span> <span class=s1>&#39;Missing parameters&#39;</span><span class=p>}),</span> <span class=mi>400</span>
</span></span><span class=line><span class=cl>    <span class=n>detail</span> <span class=o>=</span> <span class=n>get_ranking_detail</span><span class=p>(</span><span class=n>table</span><span class=p>,</span> <span class=n>source</span><span class=p>,</span> <span class=n>subject</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>jsonify</span><span class=p>(</span><span class=n>detail</span><span class=p>)</span>
</span></span></code></pre></div><hr><h2 id=4-the-database-connection-dbdatabasepy>4. The Database Connection: <code>db/database.py</code><a hidden class=anchor aria-hidden=true href=#4-the-database-connection-dbdatabasepy>#</a></h2><p>A simple but essential utility.</p><h3 id=function-get_db_connection>Function: <code>get_db_connection</code><a hidden class=anchor aria-hidden=true href=#function-get_db_connection>#</a></h3><ul><li><strong>Input</strong>: None.</li><li><strong>Logic</strong>:<ol><li>Connects to the SQLite file defined in <code>config.DATABASE</code>.</li><li>Sets <code>conn.row_factory = sqlite3.Row</code>. This is a pro tip for Flask/SQLite developers: it allows you to access database rows like dictionaries (e.g., <code>row['name']</code>) instead of just tuples (e.g., <code>row[1]</code>).</li></ol></li><li><strong>Output</strong>: An active database connection object.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_db_connection</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span> <span class=o>=</span> <span class=n>sqlite3</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=n>DATABASE</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span><span class=o>.</span><span class=n>row_factory</span> <span class=o>=</span> <span class=n>sqlite3</span><span class=o>.</span><span class=n>Row</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>conn</span>
</span></span></code></pre></div><hr><h2 id=5-data-ingestion-scriptsdata_to_db_universitiespy>5. Data Ingestion: <code>scripts/data_to_db_universities.py</code><a hidden class=anchor aria-hidden=true href=#5-data-ingestion-scriptsdata_to_db_universitiespy>#</a></h2><p>How does data get into the system? This script shows the ETL (Extract, Transform, Load) process.</p><h3 id=script-logic>Script Logic<a hidden class=anchor aria-hidden=true href=#script-logic>#</a></h3><ol><li><strong>Extract</strong>: Reads a raw CSV file (<code>data/merged_data.csv</code>) using Pandas.</li><li><strong>Transform</strong>:<ul><li>Selects only the columns we need (Name, Country, City, etc.).</li><li>Renames columns to match our SQL schema (e.g., <code>Name</code> -> <code>name</code>).</li></ul></li><li><strong>Load</strong>:<ul><li>Connects to the SQLite database.</li><li>Iterates through the Pandas DataFrame.</li><li>Executes an <code>INSERT</code> SQL command for every row.</li></ul></li><li><strong>Result</strong>: Populates the <code>Universities</code> table, which serves as the backbone for the entire application.</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Load the new CSV</span>
</span></span><span class=line><span class=cl><span class=n>df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_csv</span><span class=p>(</span><span class=s2>&#34;data/merged_data.csv&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Select and rename required columns</span>
</span></span><span class=line><span class=cl><span class=n>df</span> <span class=o>=</span> <span class=n>df</span><span class=p>[[</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Name&#34;</span><span class=p>,</span> <span class=s2>&#34;normalizedName&#34;</span><span class=p>,</span> <span class=s2>&#34;Country&#34;</span><span class=p>,</span> <span class=s2>&#34;Country Code&#34;</span><span class=p>,</span> <span class=s2>&#34;City&#34;</span><span class=p>,</span> <span class=s2>&#34;Photo&#34;</span><span class=p>,</span> <span class=s2>&#34;Blurb&#34;</span>
</span></span><span class=line><span class=cl><span class=p>]]</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Rename to match SQL table</span>
</span></span><span class=line><span class=cl><span class=n>df</span><span class=o>.</span><span class=n>columns</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;name&#34;</span><span class=p>,</span> <span class=s2>&#34;normalized_name&#34;</span><span class=p>,</span> <span class=s2>&#34;country&#34;</span><span class=p>,</span> <span class=s2>&#34;country_code&#34;</span><span class=p>,</span> <span class=s2>&#34;city&#34;</span><span class=p>,</span> <span class=s2>&#34;photo&#34;</span><span class=p>,</span> <span class=s2>&#34;blurb&#34;</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Connect to SQLite database</span>
</span></span><span class=line><span class=cl><span class=n>conn</span> <span class=o>=</span> <span class=n>sqlite3</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=s2>&#34;University_rankings.db&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>cursor</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Insert rows</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>_</span><span class=p>,</span> <span class=n>row</span> <span class=ow>in</span> <span class=n>df</span><span class=o>.</span><span class=n>iterrows</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        INSERT INTO Universities (
</span></span></span><span class=line><span class=cl><span class=s2>            normalized_name, name, country, country_code, city, photo, blurb
</span></span></span><span class=line><span class=cl><span class=s2>        ) VALUES (?, ?, ?, ?, ?, ?, ?)
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span><span class=p>,</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>row</span><span class=p>[</span><span class=s2>&#34;normalized_name&#34;</span><span class=p>],</span> <span class=n>row</span><span class=p>[</span><span class=s2>&#34;name&#34;</span><span class=p>],</span> <span class=n>row</span><span class=p>[</span><span class=s2>&#34;country&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=n>row</span><span class=p>[</span><span class=s2>&#34;country_code&#34;</span><span class=p>],</span> <span class=n>row</span><span class=p>[</span><span class=s2>&#34;city&#34;</span><span class=p>],</span> <span class=n>row</span><span class=p>[</span><span class=s2>&#34;photo&#34;</span><span class=p>],</span> <span class=n>row</span><span class=p>[</span><span class=s2>&#34;blurb&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Commit and close</span>
</span></span><span class=line><span class=cl><span class=n>conn</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>conn</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span></code></pre></div><hr><h2 id=-the-vibe-coding-perspective>üåä The Vibe Coding Perspective<a hidden class=anchor aria-hidden=true href=#-the-vibe-coding-perspective>#</a></h2><p>How does Vibe Coding (AI-assisted coding) apply to data engineering and scripts? It&rsquo;s about using AI to quickly prototype solutions, validate assumptions, and refactor code while maintaining high quality and extensibility.</p><ol><li><p><strong>Dynamic Discovery</strong>:
In <code>get_university_by_id</code>, we loop through <em>all</em> tables ending in <code>_Rankings</code>. We didn&rsquo;t create a complex <code>RankingRegistry</code> class or a configuration file. We just let the database tell us what it has.</p><ul><li><strong>AI-Assisted Architecture</strong>: With AI guidance, we identified this simpler approach over more complex alternatives. It&rsquo;s loose, flexible, and incredibly easy to extend. You don&rsquo;t have to &ldquo;register&rdquo; a new dataset; you just load it. The AI helped us avoid over-engineering.</li></ul></li><li><p><strong>Pragmatic Normalization</strong>:
The <code>normalize_name</code> function isn&rsquo;t using a complex NLP model or fuzzy matching library. It uses a simple dictionary (<code>ALIASES</code>) and some regex.</p><ul><li><strong>AI-Assisted Trade-offs</strong>: The AI helped us decide to use simple regex and aliasing rather than complex NLP, recognizing that it solves 99% of the problem with 1% of the effort. When using AI-assisted coding, you focus on the specific data issues you see (like &ldquo;MIT&rdquo; vs &ldquo;Massachusetts Institute of Technology&rdquo;), let the AI handle boilerplate and common patterns, and move on to more interesting problems.</li></ul></li></ol><hr><h2 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h2><p>The <strong>University Ranking Backend</strong> demonstrates how to build a flexible, data-driven API. By separating the &ldquo;normalization&rdquo; logic into utilities and using dynamic SQL queries to discover tables, the system can handle new ranking data with minimal code changes.</p><p>In the next part, we might explore how to deploy this system or how the frontend consumes this API!</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://xiaruize.org/tags/python/>Python</a></li><li><a href=https://xiaruize.org/tags/flask/>Flask</a></li><li><a href=https://xiaruize.org/tags/backend/>Backend</a></li><li><a href=https://xiaruize.org/tags/code-analysis/>Code Analysis</a></li><li><a href=https://xiaruize.org/tags/data-engineering/>Data Engineering</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://xiaruize.org/>xiaruize's Blog</a></span> ¬∑
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>