<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>University Ranking Frontend Deep Dive (Part 2): State Management, React Query, and Theme Architecture | xiaruize's Blog</title><meta name=keywords content="React Native,Context API,React Query,State Management,Vibe Coding"><meta name=description content="Part 2 of our deep dive into the University Ranking Frontend. We explore ThemeContext implementation, LanguageContext, RankingsProvider with React Query, and platform-specific optimizations."><meta name=author content><link rel=canonical href=https://xiaruize.org/post/university-ranking-frontend-part-2/><link crossorigin=anonymous href=/assets/css/stylesheet.e1f5c4cae44599655f7ff95195ff89c8cb3adbda94f2b1581a434ab2b4d4e6cf.css integrity="sha256-4fXEyuRFmWVff/lRlf+JyMs629qU8rFYGkNKsrTU5s8=" rel="preload stylesheet" as=style><link rel=icon href=https://xiaruize.org/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://xiaruize.org/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://xiaruize.org/favicon-32x32.png><link rel=apple-touch-icon href=https://xiaruize.org/apple-touch-icon.png><link rel=mask-icon href=https://xiaruize.org/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://xiaruize.org/post/university-ranking-frontend-part-2/><link rel=alternate hreflang=zh href=https://xiaruize.org/zh/post/university-ranking-frontend-part-2/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://xiaruize.org/post/university-ranking-frontend-part-2/"><meta property="og:site_name" content="xiaruize's Blog"><meta property="og:title" content="University Ranking Frontend Deep Dive (Part 2): State Management, React Query, and Theme Architecture"><meta property="og:description" content="Part 2 of our deep dive into the University Ranking Frontend. We explore ThemeContext implementation, LanguageContext, RankingsProvider with React Query, and platform-specific optimizations."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2025-12-07T00:00:00+00:00"><meta property="article:modified_time" content="2025-12-07T00:00:00+00:00"><meta property="article:tag" content="React Native"><meta property="article:tag" content="Context API"><meta property="article:tag" content="React Query"><meta property="article:tag" content="State Management"><meta property="article:tag" content="Vibe Coding"><meta name=twitter:card content="summary"><meta name=twitter:title content="University Ranking Frontend Deep Dive (Part 2): State Management, React Query, and Theme Architecture"><meta name=twitter:description content="Part 2 of our deep dive into the University Ranking Frontend. We explore ThemeContext implementation, LanguageContext, RankingsProvider with React Query, and platform-specific optimizations."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://xiaruize.org/post/"},{"@type":"ListItem","position":2,"name":"University Ranking Frontend Deep Dive (Part 2): State Management, React Query, and Theme Architecture","item":"https://xiaruize.org/post/university-ranking-frontend-part-2/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"University Ranking Frontend Deep Dive (Part 2): State Management, React Query, and Theme Architecture","name":"University Ranking Frontend Deep Dive (Part 2): State Management, React Query, and Theme Architecture","description":"Part 2 of our deep dive into the University Ranking Frontend. We explore ThemeContext implementation, LanguageContext, RankingsProvider with React Query, and platform-specific optimizations.","keywords":["React Native","Context API","React Query","State Management","Vibe Coding"],"articleBody":"This is Part 2 of our University Ranking Frontend code deep dive. Make sure you’ve read https://xiaruize.org/post/university-ranking-frontend/ and https://xiaruize.org/post/university-ranking-frontend-part-1/ first.\nOverview In Part 2, we’ll explore:\nThemeContext - Implementing theme switching with platform-specific persistence LanguageContext - Managing internationalization and language preferences RankingsProvider - Using React Query for background data synchronization React Query Hooks - Building reusable data fetching patterns Platform-Specific Optimizations - Handling iOS, Android, and Web differently ThemeContext: Theme Management The ThemeContext manages the entire app’s visual theme—light mode, dark mode, or automatic (following system preference). Here’s the complete implementation:\nTheme Objects export const lightTheme = { background: Platform.OS == 'android' ? '#ffffff' : '#f8f9fa', surface: '#ffffff', surfaceSecondary: '#f1f3f5', primary: '#4a90e2', text: '#2c3e50', textSecondary: '#6c757d', border: '#e1e5e9', card: '#ffffff', input: '#ffffff', shadow: '#000', }; export const darkTheme = { background: Platform.OS == 'android' ? '#121212' : '#121212', surface: '#1e1e1e', surfaceSecondary: '#434343ff', primary: '#4a90e2', text: '#ffffff', textSecondary: '#b0b0b0', border: '#333333', card: '#2a2a2a', input: '#2a2a2a', shadow: '#000', }; Notice: background differs between Android and iOS. This is Vibe Coding at work—when AI generates platform-specific code, it often discovers such nuances that manual coding might miss.\nTheme Provider with Persistence export const ThemeProvider = ({ children }) =\u003e { const systemColorScheme = useColorScheme(); const [themeMode, setThemeMode] = useState('auto'); // 'light', 'dark', or 'auto' const [isLoading, setIsLoading] = useState(true); // Determine if dark mode should be active const isDarkMode = themeMode === 'auto' ? systemColorScheme === 'dark' : themeMode === 'dark'; // Load saved theme preference on startup useEffect(() =\u003e { let isMounted = true; const loadSavedThemePreference = async () =\u003e { try { if (Platform.OS === 'web') { const themePref = window.localStorage.getItem('themePreference'); if (themePref \u0026\u0026 isMounted) { setThemeMode(themePref); } } else { // Mobile: use FileSystem const profileFile = FileSystem.documentDirectory + 'user_profile.json'; const profileExists = await FileSystem.getInfoAsync(profileFile); if (profileExists.exists) { const profileContent = await FileSystem.readAsStringAsync(profileFile); const profile = JSON.parse(profileContent); if (profile.themePreference \u0026\u0026 isMounted) { setThemeMode(profile.themePreference); } } } } catch (error) { console.error('Error loading theme:', error); if (isMounted) setThemeMode('auto'); } finally { if (isMounted) setIsLoading(false); } }; loadSavedThemePreference(); return () =\u003e { isMounted = false; }; }, []); const toggleTheme = async () =\u003e { // Cycle through: light → dark → auto → light const nextMode = themeMode === 'light' ? 'dark' : themeMode === 'dark' ? 'auto' : 'light'; setThemeMode(nextMode); // Persist to appropriate storage try { if (Platform.OS === 'web') { window.localStorage.setItem('themePreference', nextMode); } else { const profileFile = FileSystem.documentDirectory + 'user_profile.json'; let profile = { themePreference: nextMode, lastUpdated: new Date().toISOString() }; const profileExists = await FileSystem.getInfoAsync(profileFile); if (profileExists.exists) { const existingProfileContent = await FileSystem.readAsStringAsync(profileFile); const existingProfile = JSON.parse(existingProfileContent); profile = { ...existingProfile, themePreference: nextMode, lastUpdated: new Date().toISOString() }; } await FileSystem.writeAsStringAsync( profileFile, JSON.stringify(profile, null, 2) ); } } catch (error) { console.error('Error saving theme:', error); } }; const theme = isDarkMode ? darkTheme : lightTheme; return ( \u003cThemeContext.Provider value={{ theme, isDarkMode, toggleTheme }}\u003e {children} \u003c/ThemeContext.Provider\u003e ); }; Key patterns:\nPlatform detection - Use Platform.OS to branch between ‘web’, ‘ios’, ‘android’ Storage abstraction - Web uses localStorage, mobile uses FileSystem IsMounted pattern - Prevents state updates on unmounted components Three-state toggle - Cycles light → dark → auto for better UX Using the Theme Hook Components access the theme via the hook:\nfunction MyComponent() { const { theme, isDarkMode, toggleTheme } = useTheme(); return ( \u003cView style={{ backgroundColor: theme.background }}\u003e \u003cText style={{ color: theme.text }}\u003eContent\u003c/Text\u003e \u003cTouchableOpacity onPress={toggleTheme}\u003e \u003cText\u003e{isDarkMode ? 'Light' : 'Dark'} Mode\u003c/Text\u003e \u003c/TouchableOpacity\u003e \u003c/View\u003e ); } This pattern makes every component theme-aware without prop drilling.\nLanguageContext: Internationalization The LanguageContext manages language switching and device locale detection:\nexport const LanguageProvider = ({ children }) =\u003e { const [currentLanguage, setCurrentLanguage] = useState(i18n.locale); const [isLoading, setIsLoading] = useState(true); // Load saved language preference on startup useEffect(() =\u003e { let isMounted = true; const loadLanguagePreference = async () =\u003e { try { const savedLang = await loadSavedLanguagePreference(); if (savedLang \u0026\u0026 (savedLang === 'en' || savedLang === 'zh') \u0026\u0026 isMounted) { setCurrentLanguage(savedLang); i18n.locale = savedLang; } else if (isMounted) { // Fallback: use device language const deviceLang = Localization.locale.startsWith('zh') ? 'zh' : 'en'; setCurrentLanguage(deviceLang); i18n.locale = deviceLang; } } catch (error) { console.error('Error loading language:', error); if (isMounted) { const deviceLang = Localization.locale.startsWith('zh') ? 'zh' : 'en'; setCurrentLanguage(deviceLang); i18n.locale = deviceLang; } } finally { if (isMounted) setIsLoading(false); } }; loadLanguagePreference(); return () =\u003e { isMounted = false; }; }, []); const switchLanguage = async (lang) =\u003e { if (lang === 'en' || lang === 'zh') { setCurrentLanguage(lang); i18n.locale = lang; await saveLanguagePreference(lang); } }; const contextValue = { currentLanguage, isChinese: currentLanguage === 'zh', switchLanguage, isLoading, }; return ( \u003cLanguageContext.Provider value={contextValue}\u003e {children} \u003c/LanguageContext.Provider\u003e ); }; Smart pattern: Instead of exposing raw language strings, we provide isChinese boolean. This makes conditional rendering simpler:\n// In components: const { isChinese } = useLanguage(); {isChinese ? ( \u003cChineseVersionComponent /\u003e ) : ( \u003cEnglishVersionComponent /\u003e )} RankingsProvider: React Query with Caching The RankingsProvider is a sophisticated example of combining React Query with local caching:\nexport const RankingsProvider = ({ children }) =\u003e { // Use React Query to fetch data in background const { data: freshData, error, isLoading } = useRankingOptions(); const [rankingOptions, setRankingOptions] = useState([]); const [loading, setLoading] = useState(true); // Load from local cache on mount useEffect(() =\u003e { let isMounted = true; const loadCache = async () =\u003e { try { let cachedData = null; if (Platform.OS === 'web') { const cached = window.localStorage.getItem('subjectRankingOptions'); if (cached) { cachedData = JSON.parse(cached); } } else { const cacheFile = FileSystem.documentDirectory + 'subject_ranking_options.json'; const info = await FileSystem.getInfoAsync(cacheFile); if (info.exists) { const cached = await FileSystem.readAsStringAsync(cacheFile); cachedData = JSON.parse(cached); } } if (isMounted \u0026\u0026 cachedData \u0026\u0026 Array.isArray(cachedData)) { setRankingOptions(cachedData); } if (isMounted) setLoading(false); } catch (e) { console.error('Error loading cache:', e); if (isMounted) setLoading(false); } }; loadCache(); return () =\u003e { isMounted = false; }; }, []); // Update cache when fresh data arrives from React Query useEffect(() =\u003e { let isMounted = true; const updateCache = async () =\u003e { if (!isMounted || !freshData || !Array.isArray(freshData) || freshData.length === 0) { return; } setRankingOptions(freshData); setLoading(false); try { if (Platform.OS === 'web') { window.localStorage.setItem('subjectRankingOptions', JSON.stringify(freshData)); } else { const cacheFile = FileSystem.documentDirectory + 'subject_ranking_options.json'; await FileSystem.writeAsStringAsync(cacheFile, JSON.stringify(freshData)); } } catch (e) { console.error('Error saving cache:', e); } }; if (!isLoading \u0026\u0026 freshData) { updateCache(); } return () =\u003e { isMounted = false; }; }, [freshData, isLoading]); return ( \u003cRankingsContext.Provider value={{ rankingOptions: rankingOptions || [], loading, error }}\u003e {children} \u003c/RankingsContext.Provider\u003e ); }; Architecture insight: This demonstrates a two-tier caching strategy:\nLocal cache (displayed immediately) - From FileSystem/localStorage React Query cache (updated in background) - From API server When the app starts:\nLocal cache is loaded instantly React Query fetches fresh data in background When fresh data arrives, local cache is updated Components get the fresh data without delay This is Vibe Coding excellence: the AI-assisted approach recognizes that showing stale data instantly is better than showing nothing while fetching.\nReact Query Hooks: Reusable Patterns In lib/api.js, we define React Query hooks for different data types:\nexport const useRankingOptions = (options = {}) =\u003e { return useQuery({ queryKey: ['rankingOptions'], queryFn: rawApi.getRankingOptions, staleTime: 30 * 60 * 1000, // 30 minutes ...options }); }; export const useCountries = (options = {}) =\u003e { return useQuery({ queryKey: ['countries'], queryFn: rawApi.getCountries, staleTime: 60 * 60 * 1000, // 1 hour ...options }); }; export const useUniversityDetails = (normalizedName, options = {}) =\u003e { return useQuery({ queryKey: ['universityDetails', normalizedName], queryFn: () =\u003e rawApi.getUniversityDetails(normalizedName), staleTime: 10 * 60 * 1000, // 10 minutes enabled: !!normalizedName, // Only fetch if we have a name ...options }); }; export const useSearchUniversities = ({ query, country, city, sort_credit }, options = {}) =\u003e { return useQuery({ queryKey: ['searchUniversities', { query, country, city, sort_credit }], queryFn: () =\u003e rawApi.searchUniversities({ query, country, city, sort_credit }), staleTime: 2 * 60 * 1000, // 2 minutes enabled: !!(query || country || city || sort_credit), // Only run if params exist ...options }); }; Key patterns:\nStale times vary by data type:\nRanking options: 30 min (rarely changes) Countries: 1 hour (static data) University details: 10 min (changes occasionally) Search results: 2 min (user-driven) Conditional fetching via enabled:\nenabled: !!normalizedName // Don't fetch until we have data Query key structure enables automatic cache management:\nqueryKey: ['searchUniversities', { query, country, city, sort_credit }] // Changes to any parameter automatically invalidate the cache Using React Query Hooks Components can use these hooks for sophisticated data management:\nfunction RankingDetailComponent({ universityName, source }) { // Automatically manages loading, error, and data states const { data, isLoading, error } = useUniversityRankingsBySource( universityName, source ); if (isLoading) return \u003cActivityIndicator /\u003e; if (error) return \u003cText\u003eError loading rankings\u003c/Text\u003e; return ( \u003cFlatList data={data} renderItem={({ item }) =\u003e \u003cRankingItem item={item} /\u003e} keyExtractor={(item) =\u003e item.id} /\u003e ); } Platform-Specific Optimizations The app handles iOS, Android, and Web differently:\nStorage Strategy Web:\nwindow.localStorage.setItem('key', JSON.stringify(value)); Mobile:\nimport * as FileSystem from 'expo-file-system'; const filePath = FileSystem.documentDirectory + 'myfile.json'; await FileSystem.writeAsStringAsync(filePath, JSON.stringify(value)); Why different? Web doesn’t have FileSystem, mobile localStorage has size limits.\nSafeAreaView and Insets function AppContentInner() { const insets = useSafeAreaInsets(); const paddingTop = Platform.OS === 'android' ? insets.top : 0; const paddingBottom = Platform.OS === 'android' ? insets.bottom : 0; return ( \u003cGestureHandlerRootView style={{ flex: 1, paddingTop, paddingBottom, backgroundColor: theme.surface }} \u003e {/* Content */} \u003c/GestureHandlerRootView\u003e ); } Rationale: Android respects safe areas, but iOS doesn’t need manual padding because SafeAreaProvider handles it.\nHeader Height Adjustment const tabBarStyle = { backgroundColor: theme.surface, borderTopColor: theme.border, borderTopWidth: 1, paddingBottom: 0, height: 85, elevation: 0, // Android shadow shadowColor: 'transparent', // iOS shadow shadowOpacity: 0, shadowOffset: { height: 0 }, shadowRadius: 0, }; Different shadow properties for iOS (shadow*) vs Android (elevation).\nVibe Coding Insights 1. Context + Hooks \u003e Props Passing theme/language through props would require threading them through every component. Context + hooks eliminates prop drilling:\n// ❌ Without context \u003cApp theme={theme} language={language}\u003e \u003cNavigation theme={theme} language={language}\u003e \u003cScreen theme={theme} language={language}\u003e \u003cComponent theme={theme} language={language} /\u003e \u003c/Component\u003e \u003c/Navigation\u003e \u003c/App\u003e // ✅ With context \u003cThemeProvider\u003e \u003cLanguageProvider\u003e \u003cApp\u003e {/* Any component can useTheme() and useLanguage() */} \u003c/App\u003e \u003c/LanguageProvider\u003e \u003c/ThemeProvider\u003e 2. React Query Enables Offline-First With proper React Query configuration, screens can display cached data immediately, then update in background when network is available. This is superior to showing loading spinners.\n3. Platform Detection is Pragmatic Rather than trying to create one solution for all platforms, detecting the platform and applying specific logic is often cleaner than abstraction layers.\nSummary In Part 2, we explored:\n✅ ThemeContext for theme switching with platform-specific persistence ✅ LanguageContext for smart language management ✅ RankingsProvider using React Query + local caching ✅ Reusable React Query hooks for different data types ✅ Platform-specific optimizations for iOS, Android, and Web Key takeaway: Separating concerns into context providers makes every component simpler. By handling theme, language, and ranking management in dedicated contexts, screens like SearchScreen and DetailPage can focus purely on their business logic.\nThis is Vibe Coding in practice: using AI assistance to design clean, pragmatic solutions that work seamlessly across platforms while maintaining code clarity.\n","wordCount":"1820","inLanguage":"en","datePublished":"2025-12-07T00:00:00Z","dateModified":"2025-12-07T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://xiaruize.org/post/university-ranking-frontend-part-2/"},"publisher":{"@type":"Organization","name":"xiaruize's Blog","logo":{"@type":"ImageObject","url":"https://xiaruize.org/favicon.ico"}}}</script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.css integrity=sha384-zh0CIslj+VczCZtlzBcjt5ppRcsAmDnRem7ESsYwWwg3m/OaJ2l4x7YBZl9Kxxib crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.js integrity=sha384-Rma6DA2IPUwhNxmrB/7S3Tno0YY7sFu9WSYMCuulLhIqYSGZ2gKCJWIqhBWqMQfh crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/contrib/auto-render.min.js integrity=sha384-hCXGrW6PitJEwbkoStFjeJxv+fSOOQKOPbJxSfM6G5sWZjAyWhXiTIIAmQqnlLlh crossorigin=anonymous onload=renderMathInElement(document.body)></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"\\[",right:"\\]",display:!0},{left:"$$",right:"$$",display:!0},{left:"\\(",right:"\\)",display:!1},{left:"$",right:"$",display:!1}],throwOnError:!0})})</script></head><body id="
    top"><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://xiaruize.org/ accesskey=h title="xiaruize's Blog (Alt + H)">xiaruize's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://xiaruize.org/zh/ title=中文 aria-label=中文>Zh</a></li></ul></div></div><ul id=menu><li><a href=https://xiaruize.org/categories/ title=categories><span>categories</span></a></li><li><a href=https://xiaruize.org/tags/ title=tags><span>tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">University Ranking Frontend Deep Dive (Part 2): State Management, React Query, and Theme Architecture</h1><div class=post-description>Part 2 of our deep dive into the University Ranking Frontend. We explore ThemeContext implementation, LanguageContext, RankingsProvider with React Query, and platform-specific optimizations.</div><div class=post-meta><span title='2025-12-07 00:00:00 +0000 UTC'>December 7, 2025</span>&nbsp;|&nbsp;Translations:<ul class=i18n_list><li><a href=https://xiaruize.org/zh/post/university-ranking-frontend-part-2/>Zh</a></li></ul></div></header><div class=post-content><p>This is Part 2 of our University Ranking Frontend code deep dive. Make sure you&rsquo;ve read https://xiaruize.org/post/university-ranking-frontend/ and https://xiaruize.org/post/university-ranking-frontend-part-1/ first.</p><h2 id=overview>Overview<a hidden class=anchor aria-hidden=true href=#overview>#</a></h2><p>In Part 2, we&rsquo;ll explore:</p><ol><li><strong>ThemeContext</strong> - Implementing theme switching with platform-specific persistence</li><li><strong>LanguageContext</strong> - Managing internationalization and language preferences</li><li><strong>RankingsProvider</strong> - Using React Query for background data synchronization</li><li><strong>React Query Hooks</strong> - Building reusable data fetching patterns</li><li><strong>Platform-Specific Optimizations</strong> - Handling iOS, Android, and Web differently</li></ol><h2 id=themecontext-theme-management>ThemeContext: Theme Management<a hidden class=anchor aria-hidden=true href=#themecontext-theme-management>#</a></h2><p>The <code>ThemeContext</code> manages the entire app&rsquo;s visual theme—light mode, dark mode, or automatic (following system preference). Here&rsquo;s the complete implementation:</p><h3 id=theme-objects>Theme Objects<a hidden class=anchor aria-hidden=true href=#theme-objects>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=nx>lightTheme</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>background</span><span class=o>:</span> <span class=nx>Platform</span><span class=p>.</span><span class=nx>OS</span> <span class=o>==</span> <span class=s1>&#39;android&#39;</span> <span class=o>?</span> <span class=s1>&#39;#ffffff&#39;</span> <span class=o>:</span> <span class=s1>&#39;#f8f9fa&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>surface</span><span class=o>:</span> <span class=s1>&#39;#ffffff&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>surfaceSecondary</span><span class=o>:</span> <span class=s1>&#39;#f1f3f5&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>primary</span><span class=o>:</span> <span class=s1>&#39;#4a90e2&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>text</span><span class=o>:</span> <span class=s1>&#39;#2c3e50&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>textSecondary</span><span class=o>:</span> <span class=s1>&#39;#6c757d&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>border</span><span class=o>:</span> <span class=s1>&#39;#e1e5e9&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>card</span><span class=o>:</span> <span class=s1>&#39;#ffffff&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>input</span><span class=o>:</span> <span class=s1>&#39;#ffffff&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>shadow</span><span class=o>:</span> <span class=s1>&#39;#000&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=nx>darkTheme</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>background</span><span class=o>:</span> <span class=nx>Platform</span><span class=p>.</span><span class=nx>OS</span> <span class=o>==</span> <span class=s1>&#39;android&#39;</span> <span class=o>?</span> <span class=s1>&#39;#121212&#39;</span> <span class=o>:</span> <span class=s1>&#39;#121212&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>surface</span><span class=o>:</span> <span class=s1>&#39;#1e1e1e&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>surfaceSecondary</span><span class=o>:</span> <span class=s1>&#39;#434343ff&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>primary</span><span class=o>:</span> <span class=s1>&#39;#4a90e2&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>text</span><span class=o>:</span> <span class=s1>&#39;#ffffff&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>textSecondary</span><span class=o>:</span> <span class=s1>&#39;#b0b0b0&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>border</span><span class=o>:</span> <span class=s1>&#39;#333333&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>card</span><span class=o>:</span> <span class=s1>&#39;#2a2a2a&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>input</span><span class=o>:</span> <span class=s1>&#39;#2a2a2a&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>shadow</span><span class=o>:</span> <span class=s1>&#39;#000&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><p><strong>Notice:</strong> <code>background</code> differs between Android and iOS. This is <strong>Vibe Coding at work</strong>—when AI generates platform-specific code, it often discovers such nuances that manual coding might miss.</p><h3 id=theme-provider-with-persistence>Theme Provider with Persistence<a hidden class=anchor aria-hidden=true href=#theme-provider-with-persistence>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=nx>ThemeProvider</span> <span class=o>=</span> <span class=p>({</span> <span class=nx>children</span> <span class=p>})</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>systemColorScheme</span> <span class=o>=</span> <span class=nx>useColorScheme</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=p>[</span><span class=nx>themeMode</span><span class=p>,</span> <span class=nx>setThemeMode</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=s1>&#39;auto&#39;</span><span class=p>);</span> <span class=c1>// &#39;light&#39;, &#39;dark&#39;, or &#39;auto&#39;
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=p>[</span><span class=nx>isLoading</span><span class=p>,</span> <span class=nx>setIsLoading</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Determine if dark mode should be active
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>isDarkMode</span> <span class=o>=</span> <span class=nx>themeMode</span> <span class=o>===</span> <span class=s1>&#39;auto&#39;</span> 
</span></span><span class=line><span class=cl>        <span class=o>?</span> <span class=nx>systemColorScheme</span> <span class=o>===</span> <span class=s1>&#39;dark&#39;</span> 
</span></span><span class=line><span class=cl>        <span class=o>:</span> <span class=nx>themeMode</span> <span class=o>===</span> <span class=s1>&#39;dark&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Load saved theme preference on startup
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>useEffect</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nx>isMounted</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>loadSavedThemePreference</span> <span class=o>=</span> <span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=nx>Platform</span><span class=p>.</span><span class=nx>OS</span> <span class=o>===</span> <span class=s1>&#39;web&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=kr>const</span> <span class=nx>themePref</span> <span class=o>=</span> <span class=nb>window</span><span class=p>.</span><span class=nx>localStorage</span><span class=p>.</span><span class=nx>getItem</span><span class=p>(</span><span class=s1>&#39;themePreference&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=p>(</span><span class=nx>themePref</span> <span class=o>&amp;&amp;</span> <span class=nx>isMounted</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nx>setThemeMode</span><span class=p>(</span><span class=nx>themePref</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=c1>// Mobile: use FileSystem
</span></span></span><span class=line><span class=cl><span class=c1></span>                    <span class=kr>const</span> <span class=nx>profileFile</span> <span class=o>=</span> <span class=nx>FileSystem</span><span class=p>.</span><span class=nx>documentDirectory</span> <span class=o>+</span> <span class=s1>&#39;user_profile.json&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                    <span class=kr>const</span> <span class=nx>profileExists</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>FileSystem</span><span class=p>.</span><span class=nx>getInfoAsync</span><span class=p>(</span><span class=nx>profileFile</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=p>(</span><span class=nx>profileExists</span><span class=p>.</span><span class=nx>exists</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=kr>const</span> <span class=nx>profileContent</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>FileSystem</span><span class=p>.</span><span class=nx>readAsStringAsync</span><span class=p>(</span><span class=nx>profileFile</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                        <span class=kr>const</span> <span class=nx>profile</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>profileContent</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                        <span class=k>if</span> <span class=p>(</span><span class=nx>profile</span><span class=p>.</span><span class=nx>themePreference</span> <span class=o>&amp;&amp;</span> <span class=nx>isMounted</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                            <span class=nx>setThemeMode</span><span class=p>(</span><span class=nx>profile</span><span class=p>.</span><span class=nx>themePreference</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                        <span class=p>}</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;Error loading theme:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=nx>isMounted</span><span class=p>)</span> <span class=nx>setThemeMode</span><span class=p>(</span><span class=s1>&#39;auto&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=k>finally</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=nx>isMounted</span><span class=p>)</span> <span class=nx>setIsLoading</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nx>loadSavedThemePreference</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span> <span class=nx>isMounted</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span> <span class=p>[]);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>toggleTheme</span> <span class=o>=</span> <span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Cycle through: light → dark → auto → light
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>nextMode</span> <span class=o>=</span> <span class=nx>themeMode</span> <span class=o>===</span> <span class=s1>&#39;light&#39;</span> 
</span></span><span class=line><span class=cl>            <span class=o>?</span> <span class=s1>&#39;dark&#39;</span> 
</span></span><span class=line><span class=cl>            <span class=o>:</span> <span class=nx>themeMode</span> <span class=o>===</span> <span class=s1>&#39;dark&#39;</span> 
</span></span><span class=line><span class=cl>            <span class=o>?</span> <span class=s1>&#39;auto&#39;</span> 
</span></span><span class=line><span class=cl>            <span class=o>:</span> <span class=s1>&#39;light&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nx>setThemeMode</span><span class=p>(</span><span class=nx>nextMode</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// Persist to appropriate storage
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=nx>Platform</span><span class=p>.</span><span class=nx>OS</span> <span class=o>===</span> <span class=s1>&#39;web&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nb>window</span><span class=p>.</span><span class=nx>localStorage</span><span class=p>.</span><span class=nx>setItem</span><span class=p>(</span><span class=s1>&#39;themePreference&#39;</span><span class=p>,</span> <span class=nx>nextMode</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=kr>const</span> <span class=nx>profileFile</span> <span class=o>=</span> <span class=nx>FileSystem</span><span class=p>.</span><span class=nx>documentDirectory</span> <span class=o>+</span> <span class=s1>&#39;user_profile.json&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=kd>let</span> <span class=nx>profile</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nx>themePreference</span><span class=o>:</span> <span class=nx>nextMode</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nx>lastUpdated</span><span class=o>:</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>toISOString</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=kr>const</span> <span class=nx>profileExists</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>FileSystem</span><span class=p>.</span><span class=nx>getInfoAsync</span><span class=p>(</span><span class=nx>profileFile</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=nx>profileExists</span><span class=p>.</span><span class=nx>exists</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=kr>const</span> <span class=nx>existingProfileContent</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>FileSystem</span><span class=p>.</span><span class=nx>readAsStringAsync</span><span class=p>(</span><span class=nx>profileFile</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=kr>const</span> <span class=nx>existingProfile</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>existingProfileContent</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=nx>profile</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=p>...</span><span class=nx>existingProfile</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nx>themePreference</span><span class=o>:</span> <span class=nx>nextMode</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nx>lastUpdated</span><span class=o>:</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>toISOString</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                    <span class=p>};</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=kr>await</span> <span class=nx>FileSystem</span><span class=p>.</span><span class=nx>writeAsStringAsync</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=nx>profileFile</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                    <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>profile</span><span class=p>,</span> <span class=kc>null</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;Error saving theme:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>theme</span> <span class=o>=</span> <span class=nx>isDarkMode</span> <span class=o>?</span> <span class=nx>darkTheme</span> <span class=o>:</span> <span class=nx>lightTheme</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=nx>ThemeContext</span><span class=p>.</span><span class=nx>Provider</span> <span class=nx>value</span><span class=o>=</span><span class=p>{{</span> <span class=nx>theme</span><span class=p>,</span> <span class=nx>isDarkMode</span><span class=p>,</span> <span class=nx>toggleTheme</span> <span class=p>}}</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span><span class=nx>children</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=err>/ThemeContext.Provider&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><p><strong>Key patterns:</strong></p><ol><li><strong>Platform detection</strong> - Use <code>Platform.OS</code> to branch between &lsquo;web&rsquo;, &lsquo;ios&rsquo;, &lsquo;android&rsquo;</li><li><strong>Storage abstraction</strong> - Web uses localStorage, mobile uses FileSystem</li><li><strong>IsMounted pattern</strong> - Prevents state updates on unmounted components</li><li><strong>Three-state toggle</strong> - Cycles light → dark → auto for better UX</li></ol><h3 id=using-the-theme-hook>Using the Theme Hook<a hidden class=anchor aria-hidden=true href=#using-the-theme-hook>#</a></h3><p>Components access the theme via the hook:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>MyComponent</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=p>{</span> <span class=nx>theme</span><span class=p>,</span> <span class=nx>isDarkMode</span><span class=p>,</span> <span class=nx>toggleTheme</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>useTheme</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=nx>View</span> <span class=nx>style</span><span class=o>=</span><span class=p>{{</span> <span class=nx>backgroundColor</span><span class=o>:</span> <span class=nx>theme</span><span class=p>.</span><span class=nx>background</span> <span class=p>}}</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=o>&lt;</span><span class=nx>Text</span> <span class=nx>style</span><span class=o>=</span><span class=p>{{</span> <span class=nx>color</span><span class=o>:</span> <span class=nx>theme</span><span class=p>.</span><span class=nx>text</span> <span class=p>}}</span><span class=o>&gt;</span><span class=nx>Content</span><span class=o>&lt;</span><span class=err>/Text&gt;</span>
</span></span><span class=line><span class=cl>            <span class=o>&lt;</span><span class=nx>TouchableOpacity</span> <span class=nx>onPress</span><span class=o>=</span><span class=p>{</span><span class=nx>toggleTheme</span><span class=p>}</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=o>&lt;</span><span class=nx>Text</span><span class=o>&gt;</span><span class=p>{</span><span class=nx>isDarkMode</span> <span class=o>?</span> <span class=s1>&#39;Light&#39;</span> <span class=o>:</span> <span class=s1>&#39;Dark&#39;</span><span class=p>}</span> <span class=nx>Mode</span><span class=o>&lt;</span><span class=err>/Text&gt;</span>
</span></span><span class=line><span class=cl>            <span class=o>&lt;</span><span class=err>/TouchableOpacity&gt;</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=err>/View&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>This pattern makes every component theme-aware without prop drilling.</p><h2 id=languagecontext-internationalization>LanguageContext: Internationalization<a hidden class=anchor aria-hidden=true href=#languagecontext-internationalization>#</a></h2><p>The <code>LanguageContext</code> manages language switching and device locale detection:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=nx>LanguageProvider</span> <span class=o>=</span> <span class=p>({</span> <span class=nx>children</span> <span class=p>})</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=p>[</span><span class=nx>currentLanguage</span><span class=p>,</span> <span class=nx>setCurrentLanguage</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=nx>i18n</span><span class=p>.</span><span class=nx>locale</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=p>[</span><span class=nx>isLoading</span><span class=p>,</span> <span class=nx>setIsLoading</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Load saved language preference on startup
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>useEffect</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nx>isMounted</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>loadLanguagePreference</span> <span class=o>=</span> <span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=kr>const</span> <span class=nx>savedLang</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>loadSavedLanguagePreference</span><span class=p>();</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=nx>savedLang</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=nx>savedLang</span> <span class=o>===</span> <span class=s1>&#39;en&#39;</span> <span class=o>||</span> <span class=nx>savedLang</span> <span class=o>===</span> <span class=s1>&#39;zh&#39;</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=nx>isMounted</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nx>setCurrentLanguage</span><span class=p>(</span><span class=nx>savedLang</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=nx>i18n</span><span class=p>.</span><span class=nx>locale</span> <span class=o>=</span> <span class=nx>savedLang</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=nx>isMounted</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=c1>// Fallback: use device language
</span></span></span><span class=line><span class=cl><span class=c1></span>                    <span class=kr>const</span> <span class=nx>deviceLang</span> <span class=o>=</span> <span class=nx>Localization</span><span class=p>.</span><span class=nx>locale</span><span class=p>.</span><span class=nx>startsWith</span><span class=p>(</span><span class=s1>&#39;zh&#39;</span><span class=p>)</span> <span class=o>?</span> <span class=s1>&#39;zh&#39;</span> <span class=o>:</span> <span class=s1>&#39;en&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                    <span class=nx>setCurrentLanguage</span><span class=p>(</span><span class=nx>deviceLang</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=nx>i18n</span><span class=p>.</span><span class=nx>locale</span> <span class=o>=</span> <span class=nx>deviceLang</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;Error loading language:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=nx>isMounted</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=kr>const</span> <span class=nx>deviceLang</span> <span class=o>=</span> <span class=nx>Localization</span><span class=p>.</span><span class=nx>locale</span><span class=p>.</span><span class=nx>startsWith</span><span class=p>(</span><span class=s1>&#39;zh&#39;</span><span class=p>)</span> <span class=o>?</span> <span class=s1>&#39;zh&#39;</span> <span class=o>:</span> <span class=s1>&#39;en&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                    <span class=nx>setCurrentLanguage</span><span class=p>(</span><span class=nx>deviceLang</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=nx>i18n</span><span class=p>.</span><span class=nx>locale</span> <span class=o>=</span> <span class=nx>deviceLang</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=k>finally</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=nx>isMounted</span><span class=p>)</span> <span class=nx>setIsLoading</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nx>loadLanguagePreference</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span> <span class=nx>isMounted</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span> <span class=p>[]);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>switchLanguage</span> <span class=o>=</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>lang</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>lang</span> <span class=o>===</span> <span class=s1>&#39;en&#39;</span> <span class=o>||</span> <span class=nx>lang</span> <span class=o>===</span> <span class=s1>&#39;zh&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>setCurrentLanguage</span><span class=p>(</span><span class=nx>lang</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nx>i18n</span><span class=p>.</span><span class=nx>locale</span> <span class=o>=</span> <span class=nx>lang</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=kr>await</span> <span class=nx>saveLanguagePreference</span><span class=p>(</span><span class=nx>lang</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>contextValue</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>currentLanguage</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>isChinese</span><span class=o>:</span> <span class=nx>currentLanguage</span> <span class=o>===</span> <span class=s1>&#39;zh&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>switchLanguage</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>isLoading</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=nx>LanguageContext</span><span class=p>.</span><span class=nx>Provider</span> <span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>contextValue</span><span class=p>}</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span><span class=nx>children</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=err>/LanguageContext.Provider&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><p><strong>Smart pattern:</strong> Instead of exposing raw language strings, we provide <code>isChinese</code> boolean. This makes conditional rendering simpler:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// In components:
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=p>{</span> <span class=nx>isChinese</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>useLanguage</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>{</span><span class=nx>isChinese</span> <span class=o>?</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=o>&lt;</span><span class=nx>ChineseVersionComponent</span> <span class=o>/&gt;</span>
</span></span><span class=line><span class=cl><span class=p>)</span> <span class=o>:</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=o>&lt;</span><span class=nx>EnglishVersionComponent</span> <span class=o>/&gt;</span>
</span></span><span class=line><span class=cl><span class=p>)}</span>
</span></span></code></pre></div><h2 id=rankingsprovider-react-query-with-caching>RankingsProvider: React Query with Caching<a hidden class=anchor aria-hidden=true href=#rankingsprovider-react-query-with-caching>#</a></h2><p>The <code>RankingsProvider</code> is a sophisticated example of combining React Query with local caching:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=nx>RankingsProvider</span> <span class=o>=</span> <span class=p>({</span> <span class=nx>children</span> <span class=p>})</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Use React Query to fetch data in background
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=p>{</span> <span class=nx>data</span><span class=o>:</span> <span class=nx>freshData</span><span class=p>,</span> <span class=nx>error</span><span class=p>,</span> <span class=nx>isLoading</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>useRankingOptions</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=p>[</span><span class=nx>rankingOptions</span><span class=p>,</span> <span class=nx>setRankingOptions</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>([]);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=p>[</span><span class=nx>loading</span><span class=p>,</span> <span class=nx>setLoading</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Load from local cache on mount
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>useEffect</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nx>isMounted</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>loadCache</span> <span class=o>=</span> <span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=kd>let</span> <span class=nx>cachedData</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=nx>Platform</span><span class=p>.</span><span class=nx>OS</span> <span class=o>===</span> <span class=s1>&#39;web&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=kr>const</span> <span class=nx>cached</span> <span class=o>=</span> <span class=nb>window</span><span class=p>.</span><span class=nx>localStorage</span><span class=p>.</span><span class=nx>getItem</span><span class=p>(</span><span class=s1>&#39;subjectRankingOptions&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=p>(</span><span class=nx>cached</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nx>cachedData</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>cached</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=kr>const</span> <span class=nx>cacheFile</span> <span class=o>=</span> <span class=nx>FileSystem</span><span class=p>.</span><span class=nx>documentDirectory</span> <span class=o>+</span> <span class=s1>&#39;subject_ranking_options.json&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                    <span class=kr>const</span> <span class=nx>info</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>FileSystem</span><span class=p>.</span><span class=nx>getInfoAsync</span><span class=p>(</span><span class=nx>cacheFile</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=p>(</span><span class=nx>info</span><span class=p>.</span><span class=nx>exists</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=kr>const</span> <span class=nx>cached</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>FileSystem</span><span class=p>.</span><span class=nx>readAsStringAsync</span><span class=p>(</span><span class=nx>cacheFile</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                        <span class=nx>cachedData</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>cached</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=nx>isMounted</span> <span class=o>&amp;&amp;</span> <span class=nx>cachedData</span> <span class=o>&amp;&amp;</span> <span class=nb>Array</span><span class=p>.</span><span class=nx>isArray</span><span class=p>(</span><span class=nx>cachedData</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nx>setRankingOptions</span><span class=p>(</span><span class=nx>cachedData</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=nx>isMounted</span><span class=p>)</span> <span class=nx>setLoading</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>e</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;Error loading cache:&#39;</span><span class=p>,</span> <span class=nx>e</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=nx>isMounted</span><span class=p>)</span> <span class=nx>setLoading</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nx>loadCache</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span> <span class=nx>isMounted</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span> <span class=p>[]);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Update cache when fresh data arrives from React Query
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>useEffect</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nx>isMounted</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>updateCache</span> <span class=o>=</span> <span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>isMounted</span> <span class=o>||</span> <span class=o>!</span><span class=nx>freshData</span> <span class=o>||</span> <span class=o>!</span><span class=nb>Array</span><span class=p>.</span><span class=nx>isArray</span><span class=p>(</span><span class=nx>freshData</span><span class=p>)</span> <span class=o>||</span> <span class=nx>freshData</span><span class=p>.</span><span class=nx>length</span> <span class=o>===</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=nx>setRankingOptions</span><span class=p>(</span><span class=nx>freshData</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nx>setLoading</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=nx>Platform</span><span class=p>.</span><span class=nx>OS</span> <span class=o>===</span> <span class=s1>&#39;web&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nb>window</span><span class=p>.</span><span class=nx>localStorage</span><span class=p>.</span><span class=nx>setItem</span><span class=p>(</span><span class=s1>&#39;subjectRankingOptions&#39;</span><span class=p>,</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>freshData</span><span class=p>));</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=kr>const</span> <span class=nx>cacheFile</span> <span class=o>=</span> <span class=nx>FileSystem</span><span class=p>.</span><span class=nx>documentDirectory</span> <span class=o>+</span> <span class=s1>&#39;subject_ranking_options.json&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                    <span class=kr>await</span> <span class=nx>FileSystem</span><span class=p>.</span><span class=nx>writeAsStringAsync</span><span class=p>(</span><span class=nx>cacheFile</span><span class=p>,</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>freshData</span><span class=p>));</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>e</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;Error saving cache:&#39;</span><span class=p>,</span> <span class=nx>e</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>isLoading</span> <span class=o>&amp;&amp;</span> <span class=nx>freshData</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>updateCache</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span> <span class=nx>isMounted</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span> <span class=p>[</span><span class=nx>freshData</span><span class=p>,</span> <span class=nx>isLoading</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=nx>RankingsContext</span><span class=p>.</span><span class=nx>Provider</span> <span class=nx>value</span><span class=o>=</span><span class=p>{{</span>
</span></span><span class=line><span class=cl>            <span class=nx>rankingOptions</span><span class=o>:</span> <span class=nx>rankingOptions</span> <span class=o>||</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>            <span class=nx>loading</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>error</span>
</span></span><span class=line><span class=cl>        <span class=p>}}</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span><span class=nx>children</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=err>/RankingsContext.Provider&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><p><strong>Architecture insight:</strong> This demonstrates a <strong>two-tier caching strategy</strong>:</p><ol><li><strong>Local cache</strong> (displayed immediately) - From FileSystem/localStorage</li><li><strong>React Query cache</strong> (updated in background) - From API server</li></ol><p>When the app starts:</p><ol><li>Local cache is loaded instantly</li><li>React Query fetches fresh data in background</li><li>When fresh data arrives, local cache is updated</li><li>Components get the fresh data without delay</li></ol><p>This is <strong>Vibe Coding excellence</strong>: the AI-assisted approach recognizes that showing stale data instantly is better than showing nothing while fetching.</p><h2 id=react-query-hooks-reusable-patterns>React Query Hooks: Reusable Patterns<a hidden class=anchor aria-hidden=true href=#react-query-hooks-reusable-patterns>#</a></h2><p>In <code>lib/api.js</code>, we define React Query hooks for different data types:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=nx>useRankingOptions</span> <span class=o>=</span> <span class=p>(</span><span class=nx>options</span> <span class=o>=</span> <span class=p>{})</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>useQuery</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>queryKey</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;rankingOptions&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=nx>queryFn</span><span class=o>:</span> <span class=nx>rawApi</span><span class=p>.</span><span class=nx>getRankingOptions</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>staleTime</span><span class=o>:</span> <span class=mi>30</span> <span class=o>*</span> <span class=mi>60</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>,</span> <span class=c1>// 30 minutes
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>...</span><span class=nx>options</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=nx>useCountries</span> <span class=o>=</span> <span class=p>(</span><span class=nx>options</span> <span class=o>=</span> <span class=p>{})</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>useQuery</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>queryKey</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;countries&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=nx>queryFn</span><span class=o>:</span> <span class=nx>rawApi</span><span class=p>.</span><span class=nx>getCountries</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>staleTime</span><span class=o>:</span> <span class=mi>60</span> <span class=o>*</span> <span class=mi>60</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>,</span> <span class=c1>// 1 hour
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>...</span><span class=nx>options</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=nx>useUniversityDetails</span> <span class=o>=</span> <span class=p>(</span><span class=nx>normalizedName</span><span class=p>,</span> <span class=nx>options</span> <span class=o>=</span> <span class=p>{})</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>useQuery</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>queryKey</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;universityDetails&#39;</span><span class=p>,</span> <span class=nx>normalizedName</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=nx>queryFn</span><span class=o>:</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>rawApi</span><span class=p>.</span><span class=nx>getUniversityDetails</span><span class=p>(</span><span class=nx>normalizedName</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=nx>staleTime</span><span class=o>:</span> <span class=mi>10</span> <span class=o>*</span> <span class=mi>60</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>,</span> <span class=c1>// 10 minutes
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>enabled</span><span class=o>:</span> <span class=o>!!</span><span class=nx>normalizedName</span><span class=p>,</span> <span class=c1>// Only fetch if we have a name
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>...</span><span class=nx>options</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=nx>useSearchUniversities</span> <span class=o>=</span> <span class=p>({</span> <span class=nx>query</span><span class=p>,</span> <span class=nx>country</span><span class=p>,</span> <span class=nx>city</span><span class=p>,</span> <span class=nx>sort_credit</span> <span class=p>},</span> <span class=nx>options</span> <span class=o>=</span> <span class=p>{})</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>useQuery</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>queryKey</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;searchUniversities&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>query</span><span class=p>,</span> <span class=nx>country</span><span class=p>,</span> <span class=nx>city</span><span class=p>,</span> <span class=nx>sort_credit</span> <span class=p>}],</span>
</span></span><span class=line><span class=cl>        <span class=nx>queryFn</span><span class=o>:</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>rawApi</span><span class=p>.</span><span class=nx>searchUniversities</span><span class=p>({</span> <span class=nx>query</span><span class=p>,</span> <span class=nx>country</span><span class=p>,</span> <span class=nx>city</span><span class=p>,</span> <span class=nx>sort_credit</span> <span class=p>}),</span>
</span></span><span class=line><span class=cl>        <span class=nx>staleTime</span><span class=o>:</span> <span class=mi>2</span> <span class=o>*</span> <span class=mi>60</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>,</span> <span class=c1>// 2 minutes
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>enabled</span><span class=o>:</span> <span class=o>!!</span><span class=p>(</span><span class=nx>query</span> <span class=o>||</span> <span class=nx>country</span> <span class=o>||</span> <span class=nx>city</span> <span class=o>||</span> <span class=nx>sort_credit</span><span class=p>),</span> <span class=c1>// Only run if params exist
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>...</span><span class=nx>options</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><p><strong>Key patterns:</strong></p><ol><li><p><strong>Stale times vary by data type</strong>:</p><ul><li>Ranking options: 30 min (rarely changes)</li><li>Countries: 1 hour (static data)</li><li>University details: 10 min (changes occasionally)</li><li>Search results: 2 min (user-driven)</li></ul></li><li><p><strong>Conditional fetching</strong> via <code>enabled</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>enabled</span><span class=o>:</span> <span class=o>!!</span><span class=nx>normalizedName</span>  <span class=c1>// Don&#39;t fetch until we have data
</span></span></span></code></pre></div></li><li><p><strong>Query key structure</strong> enables automatic cache management:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>queryKey</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;searchUniversities&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>query</span><span class=p>,</span> <span class=nx>country</span><span class=p>,</span> <span class=nx>city</span><span class=p>,</span> <span class=nx>sort_credit</span> <span class=p>}]</span>
</span></span><span class=line><span class=cl><span class=c1>// Changes to any parameter automatically invalidate the cache
</span></span></span></code></pre></div></li></ol><h3 id=using-react-query-hooks>Using React Query Hooks<a hidden class=anchor aria-hidden=true href=#using-react-query-hooks>#</a></h3><p>Components can use these hooks for sophisticated data management:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>RankingDetailComponent</span><span class=p>({</span> <span class=nx>universityName</span><span class=p>,</span> <span class=nx>source</span> <span class=p>})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Automatically manages loading, error, and data states
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=p>{</span> <span class=nx>data</span><span class=p>,</span> <span class=nx>isLoading</span><span class=p>,</span> <span class=nx>error</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>useUniversityRankingsBySource</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=nx>universityName</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>        <span class=nx>source</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>isLoading</span><span class=p>)</span> <span class=k>return</span> <span class=o>&lt;</span><span class=nx>ActivityIndicator</span> <span class=o>/&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=k>return</span> <span class=o>&lt;</span><span class=nx>Text</span><span class=o>&gt;</span><span class=nb>Error</span> <span class=nx>loading</span> <span class=nx>rankings</span><span class=o>&lt;</span><span class=err>/Text&gt;;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=nx>FlatList</span>
</span></span><span class=line><span class=cl>            <span class=nx>data</span><span class=o>=</span><span class=p>{</span><span class=nx>data</span><span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=nx>renderItem</span><span class=o>=</span><span class=p>{({</span> <span class=nx>item</span> <span class=p>})</span> <span class=p>=&gt;</span> <span class=o>&lt;</span><span class=nx>RankingItem</span> <span class=nx>item</span><span class=o>=</span><span class=p>{</span><span class=nx>item</span><span class=p>}</span> <span class=o>/&gt;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=nx>keyExtractor</span><span class=o>=</span><span class=p>{(</span><span class=nx>item</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>item</span><span class=p>.</span><span class=nx>id</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=o>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=platform-specific-optimizations>Platform-Specific Optimizations<a hidden class=anchor aria-hidden=true href=#platform-specific-optimizations>#</a></h2><p>The app handles iOS, Android, and Web differently:</p><h3 id=storage-strategy>Storage Strategy<a hidden class=anchor aria-hidden=true href=#storage-strategy>#</a></h3><p><strong>Web:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nb>window</span><span class=p>.</span><span class=nx>localStorage</span><span class=p>.</span><span class=nx>setItem</span><span class=p>(</span><span class=s1>&#39;key&#39;</span><span class=p>,</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>value</span><span class=p>));</span>
</span></span></code></pre></div><p><strong>Mobile:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=o>*</span> <span class=nx>as</span> <span class=nx>FileSystem</span> <span class=nx>from</span> <span class=s1>&#39;expo-file-system&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>filePath</span> <span class=o>=</span> <span class=nx>FileSystem</span><span class=p>.</span><span class=nx>documentDirectory</span> <span class=o>+</span> <span class=s1>&#39;myfile.json&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>await</span> <span class=nx>FileSystem</span><span class=p>.</span><span class=nx>writeAsStringAsync</span><span class=p>(</span><span class=nx>filePath</span><span class=p>,</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>value</span><span class=p>));</span>
</span></span></code></pre></div><p><strong>Why different?</strong> Web doesn&rsquo;t have <code>FileSystem</code>, mobile localStorage has size limits.</p><h3 id=safeareaview-and-insets>SafeAreaView and Insets<a hidden class=anchor aria-hidden=true href=#safeareaview-and-insets>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>AppContentInner</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>insets</span> <span class=o>=</span> <span class=nx>useSafeAreaInsets</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>paddingTop</span> <span class=o>=</span> <span class=nx>Platform</span><span class=p>.</span><span class=nx>OS</span> <span class=o>===</span> <span class=s1>&#39;android&#39;</span> <span class=o>?</span> <span class=nx>insets</span><span class=p>.</span><span class=nx>top</span> <span class=o>:</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>paddingBottom</span> <span class=o>=</span> <span class=nx>Platform</span><span class=p>.</span><span class=nx>OS</span> <span class=o>===</span> <span class=s1>&#39;android&#39;</span> <span class=o>?</span> <span class=nx>insets</span><span class=p>.</span><span class=nx>bottom</span> <span class=o>:</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=nx>GestureHandlerRootView</span> 
</span></span><span class=line><span class=cl>            <span class=nx>style</span><span class=o>=</span><span class=p>{{</span> 
</span></span><span class=line><span class=cl>                <span class=nx>flex</span><span class=o>:</span> <span class=mi>1</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                <span class=nx>paddingTop</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                <span class=nx>paddingBottom</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>backgroundColor</span><span class=o>:</span> <span class=nx>theme</span><span class=p>.</span><span class=nx>surface</span> 
</span></span><span class=line><span class=cl>            <span class=p>}}</span>
</span></span><span class=line><span class=cl>        <span class=o>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span><span class=cm>/* Content */</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=err>/GestureHandlerRootView&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>Rationale:</strong> Android respects safe areas, but iOS doesn&rsquo;t need manual padding because SafeAreaProvider handles it.</p><h3 id=header-height-adjustment>Header Height Adjustment<a hidden class=anchor aria-hidden=true href=#header-height-adjustment>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>tabBarStyle</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>backgroundColor</span><span class=o>:</span> <span class=nx>theme</span><span class=p>.</span><span class=nx>surface</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>borderTopColor</span><span class=o>:</span> <span class=nx>theme</span><span class=p>.</span><span class=nx>border</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>borderTopWidth</span><span class=o>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>paddingBottom</span><span class=o>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>height</span><span class=o>:</span> <span class=mi>85</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>elevation</span><span class=o>:</span> <span class=mi>0</span><span class=p>,</span>           <span class=c1>// Android shadow
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>shadowColor</span><span class=o>:</span> <span class=s1>&#39;transparent&#39;</span><span class=p>,</span> <span class=c1>// iOS shadow
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>shadowOpacity</span><span class=o>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>shadowOffset</span><span class=o>:</span> <span class=p>{</span> <span class=nx>height</span><span class=o>:</span> <span class=mi>0</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>shadowRadius</span><span class=o>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><p>Different shadow properties for iOS (shadow*) vs Android (elevation).</p><h2 id=vibe-coding-insights>Vibe Coding Insights<a hidden class=anchor aria-hidden=true href=#vibe-coding-insights>#</a></h2><h3 id=1-context--hooks--props>1. Context + Hooks > Props<a hidden class=anchor aria-hidden=true href=#1-context--hooks--props>#</a></h3><p>Passing theme/language through props would require threading them through every component. Context + hooks eliminates prop drilling:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// ❌ Without context
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>&lt;</span><span class=nx>App</span> <span class=nx>theme</span><span class=o>=</span><span class=p>{</span><span class=nx>theme</span><span class=p>}</span> <span class=nx>language</span><span class=o>=</span><span class=p>{</span><span class=nx>language</span><span class=p>}</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=o>&lt;</span><span class=nx>Navigation</span> <span class=nx>theme</span><span class=o>=</span><span class=p>{</span><span class=nx>theme</span><span class=p>}</span> <span class=nx>language</span><span class=o>=</span><span class=p>{</span><span class=nx>language</span><span class=p>}</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=o>&lt;</span><span class=nx>Screen</span> <span class=nx>theme</span><span class=o>=</span><span class=p>{</span><span class=nx>theme</span><span class=p>}</span> <span class=nx>language</span><span class=o>=</span><span class=p>{</span><span class=nx>language</span><span class=p>}</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=o>&lt;</span><span class=nx>Component</span> <span class=nx>theme</span><span class=o>=</span><span class=p>{</span><span class=nx>theme</span><span class=p>}</span> <span class=nx>language</span><span class=o>=</span><span class=p>{</span><span class=nx>language</span><span class=p>}</span> <span class=o>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=o>&lt;</span><span class=err>/Component&gt;</span>
</span></span><span class=line><span class=cl>  <span class=o>&lt;</span><span class=err>/Navigation&gt;</span>
</span></span><span class=line><span class=cl><span class=o>&lt;</span><span class=err>/App&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ✅ With context
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>&lt;</span><span class=nx>ThemeProvider</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=o>&lt;</span><span class=nx>LanguageProvider</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=o>&lt;</span><span class=nx>App</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span><span class=cm>/* Any component can useTheme() and useLanguage() */</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=o>&lt;</span><span class=err>/App&gt;</span>
</span></span><span class=line><span class=cl>  <span class=o>&lt;</span><span class=err>/LanguageProvider&gt;</span>
</span></span><span class=line><span class=cl><span class=o>&lt;</span><span class=err>/ThemeProvider&gt;</span>
</span></span></code></pre></div><h3 id=2-react-query-enables-offline-first>2. React Query Enables Offline-First<a hidden class=anchor aria-hidden=true href=#2-react-query-enables-offline-first>#</a></h3><p>With proper React Query configuration, screens can display cached data immediately, then update in background when network is available. This is superior to showing loading spinners.</p><h3 id=3-platform-detection-is-pragmatic>3. Platform Detection is Pragmatic<a hidden class=anchor aria-hidden=true href=#3-platform-detection-is-pragmatic>#</a></h3><p>Rather than trying to create one solution for all platforms, detecting the platform and applying specific logic is often cleaner than abstraction layers.</p><h2 id=summary>Summary<a hidden class=anchor aria-hidden=true href=#summary>#</a></h2><p>In Part 2, we explored:</p><ul><li>✅ ThemeContext for theme switching with platform-specific persistence</li><li>✅ LanguageContext for smart language management</li><li>✅ RankingsProvider using React Query + local caching</li><li>✅ Reusable React Query hooks for different data types</li><li>✅ Platform-specific optimizations for iOS, Android, and Web</li></ul><p>Key takeaway: <strong>Separating concerns into context providers makes every component simpler</strong>. By handling theme, language, and ranking management in dedicated contexts, screens like SearchScreen and DetailPage can focus purely on their business logic.</p><p>This is Vibe Coding in practice: using AI assistance to design clean, pragmatic solutions that work seamlessly across platforms while maintaining code clarity.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://xiaruize.org/tags/react-native/>React Native</a></li><li><a href=https://xiaruize.org/tags/context-api/>Context API</a></li><li><a href=https://xiaruize.org/tags/react-query/>React Query</a></li><li><a href=https://xiaruize.org/tags/state-management/>State Management</a></li><li><a href=https://xiaruize.org/tags/vibe-coding/>Vibe Coding</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://xiaruize.org/>xiaruize's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>