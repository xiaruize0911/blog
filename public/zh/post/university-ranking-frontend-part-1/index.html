<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>University Ranking Frontend 深度分析（第一部分）：导航架构与搜索实现 | xiaruize's Blog</title><meta name=keywords content="React Native,导航,搜索,Vibe Coding,实现"><meta name=description content="我们对 University Ranking Frontend 代码的深度分析第一部分。探索 App.js 中的导航编排，实现具有实时过滤和底部工作表模态框的 SearchScreen，并构建大学资料的 DetailPage。"><meta name=author content><link rel=canonical href=https://xiaruize.org/zh/post/university-ranking-frontend-part-1/><link crossorigin=anonymous href=/assets/css/stylesheet.e1f5c4cae44599655f7ff95195ff89c8cb3adbda94f2b1581a434ab2b4d4e6cf.css integrity="sha256-4fXEyuRFmWVff/lRlf+JyMs629qU8rFYGkNKsrTU5s8=" rel="preload stylesheet" as=style><link rel=icon href=https://xiaruize.org/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://xiaruize.org/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://xiaruize.org/favicon-32x32.png><link rel=apple-touch-icon href=https://xiaruize.org/apple-touch-icon.png><link rel=mask-icon href=https://xiaruize.org/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://xiaruize.org/post/university-ranking-frontend-part-1/><link rel=alternate hreflang=zh href=https://xiaruize.org/zh/post/university-ranking-frontend-part-1/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://xiaruize.org/zh/post/university-ranking-frontend-part-1/"><meta property="og:site_name" content="xiaruize's Blog"><meta property="og:title" content="University Ranking Frontend 深度分析（第一部分）：导航架构与搜索实现"><meta property="og:description" content="我们对 University Ranking Frontend 代码的深度分析第一部分。探索 App.js 中的导航编排，实现具有实时过滤和底部工作表模态框的 SearchScreen，并构建大学资料的 DetailPage。"><meta property="og:locale" content="zh"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2025-12-07T00:00:00+00:00"><meta property="article:modified_time" content="2025-12-07T00:00:00+00:00"><meta property="article:tag" content="React Native"><meta property="article:tag" content="导航"><meta property="article:tag" content="搜索"><meta property="article:tag" content="Vibe Coding"><meta property="article:tag" content="实现"><meta name=twitter:card content="summary"><meta name=twitter:title content="University Ranking Frontend 深度分析（第一部分）：导航架构与搜索实现"><meta name=twitter:description content="我们对 University Ranking Frontend 代码的深度分析第一部分。探索 App.js 中的导航编排，实现具有实时过滤和底部工作表模态框的 SearchScreen，并构建大学资料的 DetailPage。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://xiaruize.org/zh/post/"},{"@type":"ListItem","position":2,"name":"University Ranking Frontend 深度分析（第一部分）：导航架构与搜索实现","item":"https://xiaruize.org/zh/post/university-ranking-frontend-part-1/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"University Ranking Frontend 深度分析（第一部分）：导航架构与搜索实现","name":"University Ranking Frontend 深度分析（第一部分）：导航架构与搜索实现","description":"我们对 University Ranking Frontend 代码的深度分析第一部分。探索 App.js 中的导航编排，实现具有实时过滤和底部工作表模态框的 SearchScreen，并构建大学资料的 DetailPage。","keywords":["React Native","导航","搜索","Vibe Coding","实现"],"articleBody":"这是我们 University Ranking Frontend 代码深度分析的第一部分。如果你还没有阅读 https://xiaruize.org/zh/post/university-ranking-frontend/ 介绍，我建议从那里开始。\n概述 在第一部分，我们将探索：\n导航编排 - 如何在 App.js 中编排底部标签和堆栈导航器 SearchScreen 实现 - 用实时过滤构建主搜索界面 DetailPage 构造 - 显示包含动态内容的全面大学资料 API 集成 - 用 axios 获取数据并处理异步操作 架构课程：我们为什么使用这种导航模式 许多开发者会过度思考导航。University Ranking Frontend 使用一个简单但强大的模式：\n底部标签 ├── 首页（搜索） │ └── 堆栈导航器 │ ├── SearchScreen │ ├── DetailPage │ └── UniversitySourceRankingsPage ├── 学科排名 │ └── 堆栈导航器 │ ├── SubjectRankingsPage │ ├── RankingDetailPage │ └── DetailPage ├── 收藏 │ └── 堆栈导航器 │ └── FavoritesScreen └── 我的（个人资料） └── 堆栈导航器 └── MeScreen 为什么这样有效：\n底部标签在主应用部分之间提供持久导航 每个标签内的堆栈导航器启用推送/弹出转换以显示详细视图 共享屏幕（DetailPage 出现在多个堆栈中）在不同上下文中重用组件 这是 Vibe Coding 的实际应用：与其发明自定义导航系统，我们使用经证明的 React Navigation 模式，AI 可以快速建议和改进。\nApp.js：导航编排器 让我们检查根 App.js 文件，它设置了整个导航层次结构：\nimport React, { useState, useEffect } from 'react'; import { NavigationContainer } from '@react-navigation/native'; import { createBottomTabNavigator } from '@react-navigation/bottom-tabs'; import { createNativeStackNavigator } from '@react-navigation/native-stack'; import { BottomSheetModalProvider } from '@gorhom/bottom-sheet'; import { GestureHandlerRootView } from 'react-native-gesture-handler'; import { QueryClient, QueryClientProvider } from '@tanstack/react-query'; // 初始化 React Query 客户端 const queryClient = new QueryClient({ defaultOptions: { queries: { staleTime: 5 * 60 * 1000, // 5 分钟 cacheTime: 10 * 60 * 1000, // 10 分钟 retry: 2, refetchOnWindowFocus: false, }, }, }); const Stack = createNativeStackNavigator(); const Tab = createBottomTabNavigator(); 关键配置决策：\nStale Time（5 分钟）：5 分钟后，缓存数据被视为陈旧，React Query 将在后台刷新 Cache Time（10 分钟）：在垃圾收集前保持缓存数据 10 分钟 Retry（2）：在显示错误前自动重试失败的请求两次 refetchOnWindowFocus（false）：应用重新获得焦点时不重新获取（为了更好的用户体验） 这个配置是务实的：它平衡了响应性和网络效率。\nHome 堆栈（SearchScreen） Home 堆栈是主导航入口点：\nfunction HomeScreen() { const { theme } = useTheme(); return ( \u003cStack.Navigator screenOptions={{ headerStyle: { backgroundColor: theme.surface, }, headerTintColor: theme.text, headerTitleStyle: { color: theme.text, }, }} \u003e \u003cStack.Screen name=\"SearchScreen\" component={SearchScreen} options={{ headerShown: false }} /\u003e \u003cStack.Screen name=\"DetailPage\" component={UniversityDetail} options={({ route }) =\u003e ({ title: route.params.name || i18n.t('university_details'), })} /\u003e \u003cStack.Screen name=\"UniversitySourceRankingsPage\" component={UniversitySourceRankingsPage} options={({ route }) =\u003e ({ title: route.params.universityName + ' ' + formatSourceName(route.params.source), })} /\u003e \u003c/Stack.Navigator\u003e ); } 关键模式：头部样式是主题感知的。每当用户切换深色模式时，这些颜色实时更新，因为我们从 useTheme() hook 中读取。\nContext Provider 组合 App.js 用 context providers 包装整个导航树：\nfunction AppRoot() { return ( \u003cQueryClientProvider client={queryClient}\u003e \u003cThemeProvider\u003e \u003cLanguageProvider\u003e \u003cUniversityTranslationsProvider\u003e \u003cRankingsProvider\u003e \u003cAppContentInner /\u003e \u003c/RankingsProvider\u003e \u003c/UniversityTranslationsProvider\u003e \u003c/LanguageProvider\u003e \u003c/ThemeProvider\u003e \u003c/QueryClientProvider\u003e ); } 顺序很重要：\nQueryClientProvider（最外层）- 管理所有服务器状态 ThemeProvider - 为所有组件提供配色方案 LanguageProvider - 提供语言和翻译函数 UniversityTranslationsProvider - 提供缓存的大学名称翻译 RankingsProvider - 为过滤器提供排名选项 每个 provider 都是独立的，可以单独测试。\nSearchScreen：实时大学搜索 SearchScreen 是应用中最复杂的组件。它实现了：\n带防抖的实时搜索 带底部工作表的过滤器选择 动画加载旋转器 带平台特定调整的响应式布局 用 Effects 进行数据获取 export default function SearchScreen() { const [query, setQuery] = useState(''); const [country, setCountry] = useState(null); const [sortCredit, setSortCredit] = useState('QS_World_University_Rankings'); const [results, setResults] = useState([]); const [isLoading, setIsLoading] = useState(false); // 当过滤器改变时获取大学 useEffect(() =\u003e { let isMounted = true; const fetchData = async () =\u003e { if (!isMounted) return; setIsLoading(true); try { const data = await searchUniversities({ query, country, sort_credit: sortCredit }); if (!isMounted) return; // 如果卸载则不更新 const cleaned = data.map(u =\u003e ({ ...u, country: u.country || '', city: u.city || '' })); setResults(cleaned); } catch (error) { console.error('Error fetching universities:', error); if (isMounted) setResults([]); } finally { if (isMounted) setIsLoading(false); } }; fetchData(); return () =\u003e { isMounted = false; // 防止在卸载的组件上更新 }; }, [query, country, sortCredit]); // 当过滤器改变时重新运行 } Vibe Coding 模式：isMounted 标志防止内存泄漏和竞态条件。AI 建议了这个模式，因为：\n导航可以在异步操作完成前卸载屏幕 没有 isMounted，在卸载的组件上更新状态会导致警告 这个模式对于 React hooks 是习用的 用底部工作表模态框进行过滤 SearchScreen 使用底部工作表模态框进行国家和排名选择：\nimport { BottomSheetModal, BottomSheetScrollView, BottomSheetBackdrop } from '@gorhom/bottom-sheet'; const countrySheetRef = useRef(null); const rankingSheetRef = useRef(null); const snapPoints = useMemo(() =\u003e ['60%', '75%', '90%'], []); // 打开国家过滤器 const handleCountryPress = useCallback(() =\u003e { setCountrySearchQuery(''); rankingSheetRef.current?.dismiss(); // 关闭其他工作表 countrySheetRef.current?.present(); }, []); // 当用户输入时过滤国家 const filteredCountryItems = useMemo(() =\u003e { if (!countrySearchQuery) return countryItems; return countryItems.filter(item =\u003e item.label.toLowerCase().includes(countrySearchQuery.toLowerCase()) ); }, [countryItems, countrySearchQuery]); 关键见解：底部工作表提供原生般的用户体验，其中过滤器易于访问但不隐藏主要内容。snapPoints 允许用户将工作表拖动到不同的高度。\n搜索结果显示 搜索结果显示在 FlatList 中，用于高效渲染大型列表：\n\u003cFlatList data={results} keyExtractor={(item) =\u003e item.normalized_name} renderItem={({ item }) =\u003e ( \u003cTouchableOpacity onPress={() =\u003e navigation.navigate('DetailPage', { normalized_name: item.normalized_name, name: item.name, country: item.country, })} \u003e \u003cView style={styles.resultItem}\u003e \u003cText style={styles.resultName}\u003e{item.name}\u003c/Text\u003e \u003cText style={styles.resultLocation}\u003e {item.city}, {item.country} \u003c/Text\u003e \u003c/View\u003e \u003c/TouchableOpacity\u003e )} ListEmptyComponent={() =\u003e ( \u003cText style={styles.emptyText}\u003e {isLoading ? i18n.t('searching') : i18n.t('no_results')} \u003c/Text\u003e )} /\u003e 模式：使用 normalized_name 作为列表键和传递到 DetailPage 的标识符，确保整个应用的一致性。\nDetailPage：全面的大学资料 DetailPage 显示：\n大学徽标和基本信息 跨多个来源的排名 大学描述（必要时动态翻译） 收藏/取消收藏功能 链接到详细排名细节 异步数据加载 export default function GetUniversityDetail(props) { const normalized_name = props.route.params.normalized_name; const [university, setUniversity] = useState(null); const [loading, setLoading] = useState(true); const [translatedBlurb, setTranslatedBlurb] = useState(''); const [translationLoading, setTranslationLoading] = useState(false); const { isChinese } = useLanguage(); // 获取大学详情 useEffect(() =\u003e { if (normalized_name) { getUniversityDetails(normalized_name) .then(data =\u003e { if (data.notFound) { navigation.goBack(); } else { setUniversity(data); setLoading(false); checkIfFavorite(data); } }) .catch(err =\u003e { console.error('Error fetching details:', err); setLoading(false); }); } }, [normalized_name]); // 当语言改变时翻译描述 useEffect(() =\u003e { let isMounted = true; const translateBlurbIfNeeded = async () =\u003e { if (university \u0026\u0026 university.blurb \u0026\u0026 isChinese) { setTranslationLoading(true); try { const translated = await translateText(university.blurb, 'en', 'zh-Hans'); if (isMounted) { setTranslatedBlurb(translated); } } catch (error) { console.error('Translation failed:', error); } } else { if (isMounted) setTranslatedBlurb(''); } }; translateBlurbIfNeeded(); return () =\u003e { isMounted = false; }; }, [university, isChinese]); } 关键模式：翻译作为副作用处理，当语言上下文改变时。这保持了翻译逻辑与组件渲染分离。\n用 AsyncStorage 管理收藏 const checkIfFavorite = async (universityData) =\u003e { try { const stored = await AsyncStorage.getItem('favoriteUniversities'); if (stored) { const favorites = JSON.parse(stored); const isCurrentFavorite = favorites.some(fav =\u003e fav.normalized_name === universityData.normalized_name || fav.id === universityData.id ); setIsFavorite(isCurrentFavorite); } } catch (error) { console.error('Error checking favorites:', error); } }; const toggleFavorite = async () =\u003e { if (!university) return; setFavoriteLoading(true); try { const stored = await AsyncStorage.getItem('favoriteUniversities'); let favorites = stored ? JSON.parse(stored) : []; const favoriteData = { id: university.id || university.normalized_name, normalized_name: university.normalized_name, name: university.name, country: university.country, city: university.city, photo: university.photo }; if (isFavorite) { // 从收藏中删除 favorites = favorites.filter(fav =\u003e fav.normalized_name !== university.normalized_name \u0026\u0026 fav.id !== university.id ); setIsFavorite(false); } else { // 添加到收藏 favorites.push(favoriteData); setIsFavorite(true); } await AsyncStorage.setItem('favoriteUniversities', JSON.stringify(favorites)); await updateFavoriteCount(favorites.length); } catch (error) { console.error('Error updating favorites:', error); } finally { setFavoriteLoading(false); } }; Vibe Coding 见解：与其向后端同步收藏，我们用 AsyncStorage 本地存储它们。这提供了：\n即时反馈（无网络延迟） 离线工作 减少服务器负载 favoriteLoading 状态确保 UI 在切换操作期间显示加载状态。\nAPI 集成：lib/api.js 层 API 层将 API 调用与组件分离：\nimport { API_BASE_URL } from '../constants/config'; import axios from 'axios'; const rawApi = { async searchUniversities({ query, country, city, sort_credit }) { const response = await axios.get(`${API_BASE_URL}/universities/filter`, { params: { query, country, city, sort_credit } }); return response.data; }, async getUniversityDetails(normalizedName) { const response = await axios.get(`${API_BASE_URL}/universities/${normalizedName}`); if (response.status !== 200) { throw new Error(`Failed to fetch: ${response.status}`); } return response.data; }, async translateText(text, from, to) { const response = await axios.post(`${API_BASE_URL}/translate`, { text, from_lang: from, to_lang: to }); return response.data.translatedText; } }; // 导出函数供直接使用 export const searchUniversities = rawApi.searchUniversities; export const getUniversityDetails = rawApi.getUniversityDetails; export const translateText = rawApi.translateText; 这个模式的好处：\n可测试性：易于为单元测试模拟 rawApi 可重用性：API 函数可以直接使用或用 React Query 包装 可维护性：所有 API 调用在一个地方 从 Vibe Coding 得到的设计见解 1. 实时搜索比防抖更简单 最初，防抖搜索似乎是必需的以减少 API 调用。然而，后端过滤端点很快，网络很可靠。所以我们跳过防抖并让用户看到即时结果。这是 Vibe Coding：务实的选择优于理论上的优化。\n2. 底部工作表 \u003e 模态对话框 原生般的底部工作表提供比居中模态框更好的用户体验，因为：\n用户可以看到工作表后的内容 拖动关闭感觉自然 屏幕空间使用高效 AI 建议 @gorhom/bottom-sheet，因为它提供平滑的动画和手势处理。\n3. Context + AsyncStorage \u003e 用于偏好的 Redux 用 AsyncStorage 和 React Context 本地管理收藏比以下更简单：\nRedux + Redux Persist 同步到后端 复杂的状态管理 Vibe Coding 帮助我们认识到并非所有内容都需要在全局状态中。\n总结 在第一部分中，我们探索了：\n✅ 导航如何在 App.js 中用底部标签和堆栈导航器编排 ✅ 用实时过滤和底部工作表模态框构建 SearchScreen ✅ 实现具有异步数据加载和收藏管理的 DetailPage ✅ 为可重用性和可测试性构造 API 调用 在 https://xiaruize.org/zh/post/university-ranking-frontend-part-2/ 中，我们将深入探讨：\nContext 实现细节（ThemeContext、LanguageContext、RankingsProvider） React Query 用于复杂数据管理的模式 主题感知 UI 的组件样式模式 平台特定的考虑因素 关键要点：好的导航架构启用干净的组件设计。通过在 App.js 中处理导航问题，单个屏幕可以专注于其特定职责——搜索、显示和管理数据。\n","wordCount":"1080","inLanguage":"zh","datePublished":"2025-12-07T00:00:00Z","dateModified":"2025-12-07T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://xiaruize.org/zh/post/university-ranking-frontend-part-1/"},"publisher":{"@type":"Organization","name":"xiaruize's Blog","logo":{"@type":"ImageObject","url":"https://xiaruize.org/favicon.ico"}}}</script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.css integrity=sha384-zh0CIslj+VczCZtlzBcjt5ppRcsAmDnRem7ESsYwWwg3m/OaJ2l4x7YBZl9Kxxib crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.js integrity=sha384-Rma6DA2IPUwhNxmrB/7S3Tno0YY7sFu9WSYMCuulLhIqYSGZ2gKCJWIqhBWqMQfh crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/contrib/auto-render.min.js integrity=sha384-hCXGrW6PitJEwbkoStFjeJxv+fSOOQKOPbJxSfM6G5sWZjAyWhXiTIIAmQqnlLlh crossorigin=anonymous onload=renderMathInElement(document.body)></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"\\[",right:"\\]",display:!0},{left:"$$",right:"$$",display:!0},{left:"\\(",right:"\\)",display:!1},{left:"$",right:"$",display:!1}],throwOnError:!0})})</script></head><body id="
    top"><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://xiaruize.org/zh/ accesskey=h title="xiaruize's Blog (Alt + H)">xiaruize's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://xiaruize.org/ title=English aria-label=English>En</a></li></ul></div></div><ul id=menu><li><a href=https://xiaruize.org/zh/categories/ title=categories><span>categories</span></a></li><li><a href=https://xiaruize.org/zh/tags/ title=tags><span>tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">University Ranking Frontend 深度分析（第一部分）：导航架构与搜索实现</h1><div class=post-description>我们对 University Ranking Frontend 代码的深度分析第一部分。探索 App.js 中的导航编排，实现具有实时过滤和底部工作表模态框的 SearchScreen，并构建大学资料的 DetailPage。</div><div class=post-meta><span title='2025-12-07 00:00:00 +0000 UTC'>2025年12月7日</span>&nbsp;|&nbsp;语言:<ul class=i18n_list><li><a href=https://xiaruize.org/post/university-ranking-frontend-part-1/>En</a></li></ul></div></header><div class=post-content><p>这是我们 University Ranking Frontend 代码深度分析的第一部分。如果你还没有阅读 https://xiaruize.org/zh/post/university-ranking-frontend/ 介绍，我建议从那里开始。</p><h2 id=概述>概述<a hidden class=anchor aria-hidden=true href=#概述>#</a></h2><p>在第一部分，我们将探索：</p><ol><li><strong>导航编排</strong> - 如何在 <code>App.js</code> 中编排底部标签和堆栈导航器</li><li><strong>SearchScreen 实现</strong> - 用实时过滤构建主搜索界面</li><li><strong>DetailPage 构造</strong> - 显示包含动态内容的全面大学资料</li><li><strong>API 集成</strong> - 用 axios 获取数据并处理异步操作</li></ol><h2 id=架构课程我们为什么使用这种导航模式>架构课程：我们为什么使用这种导航模式<a hidden class=anchor aria-hidden=true href=#架构课程我们为什么使用这种导航模式>#</a></h2><p>许多开发者会过度思考导航。University Ranking Frontend 使用一个简单但强大的模式：</p><pre tabindex=0><code>底部标签
├── 首页（搜索）
│   └── 堆栈导航器
│       ├── SearchScreen
│       ├── DetailPage
│       └── UniversitySourceRankingsPage
├── 学科排名
│   └── 堆栈导航器
│       ├── SubjectRankingsPage
│       ├── RankingDetailPage
│       └── DetailPage
├── 收藏
│   └── 堆栈导航器
│       └── FavoritesScreen
└── 我的（个人资料）
    └── 堆栈导航器
        └── MeScreen
</code></pre><p><strong>为什么这样有效：</strong></p><ul><li><strong>底部标签</strong>在主应用部分之间提供持久导航</li><li><strong>每个标签内的堆栈导航器</strong>启用推送/弹出转换以显示详细视图</li><li><strong>共享屏幕</strong>（DetailPage 出现在多个堆栈中）在不同上下文中重用组件</li></ul><p>这是 <strong>Vibe Coding 的实际应用</strong>：与其发明自定义导航系统，我们使用经证明的 React Navigation 模式，AI 可以快速建议和改进。</p><h2 id=appjs导航编排器>App.js：导航编排器<a hidden class=anchor aria-hidden=true href=#appjs导航编排器>#</a></h2><p>让我们检查根 App.js 文件，它设置了整个导航层次结构：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=nx>React</span><span class=p>,</span> <span class=p>{</span> <span class=nx>useState</span><span class=p>,</span> <span class=nx>useEffect</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;react&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>NavigationContainer</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@react-navigation/native&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>createBottomTabNavigator</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@react-navigation/bottom-tabs&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>createNativeStackNavigator</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@react-navigation/native-stack&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>BottomSheetModalProvider</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@gorhom/bottom-sheet&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>GestureHandlerRootView</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;react-native-gesture-handler&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>QueryClient</span><span class=p>,</span> <span class=nx>QueryClientProvider</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@tanstack/react-query&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 初始化 React Query 客户端
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>queryClient</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>QueryClient</span><span class=p>({</span>
</span></span><span class=line><span class=cl>	<span class=nx>defaultOptions</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>queries</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>staleTime</span><span class=o>:</span> <span class=mi>5</span> <span class=o>*</span> <span class=mi>60</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>,</span> <span class=c1>// 5 分钟
</span></span></span><span class=line><span class=cl><span class=c1></span>			<span class=nx>cacheTime</span><span class=o>:</span> <span class=mi>10</span> <span class=o>*</span> <span class=mi>60</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>,</span> <span class=c1>// 10 分钟
</span></span></span><span class=line><span class=cl><span class=c1></span>			<span class=nx>retry</span><span class=o>:</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>refetchOnWindowFocus</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=p>},</span>
</span></span><span class=line><span class=cl>	<span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>Stack</span> <span class=o>=</span> <span class=nx>createNativeStackNavigator</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>Tab</span> <span class=o>=</span> <span class=nx>createBottomTabNavigator</span><span class=p>();</span>
</span></span></code></pre></div><p>关键配置决策：</p><ol><li><strong>Stale Time（5 分钟）</strong>：5 分钟后，缓存数据被视为陈旧，React Query 将在后台刷新</li><li><strong>Cache Time（10 分钟）</strong>：在垃圾收集前保持缓存数据 10 分钟</li><li><strong>Retry（2）</strong>：在显示错误前自动重试失败的请求两次</li><li><strong>refetchOnWindowFocus（false）</strong>：应用重新获得焦点时不重新获取（为了更好的用户体验）</li></ol><p>这个配置是务实的：它平衡了响应性和网络效率。</p><h3 id=home-堆栈searchscreen>Home 堆栈（SearchScreen）<a hidden class=anchor aria-hidden=true href=#home-堆栈searchscreen>#</a></h3><p>Home 堆栈是主导航入口点：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>HomeScreen</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kr>const</span> <span class=p>{</span> <span class=nx>theme</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>useTheme</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>		<span class=o>&lt;</span><span class=nx>Stack</span><span class=p>.</span><span class=nx>Navigator</span>
</span></span><span class=line><span class=cl>			<span class=nx>screenOptions</span><span class=o>=</span><span class=p>{{</span>
</span></span><span class=line><span class=cl>				<span class=nx>headerStyle</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>					<span class=nx>backgroundColor</span><span class=o>:</span> <span class=nx>theme</span><span class=p>.</span><span class=nx>surface</span><span class=p>,</span>
</span></span><span class=line><span class=cl>				<span class=p>},</span>
</span></span><span class=line><span class=cl>				<span class=nx>headerTintColor</span><span class=o>:</span> <span class=nx>theme</span><span class=p>.</span><span class=nx>text</span><span class=p>,</span>
</span></span><span class=line><span class=cl>				<span class=nx>headerTitleStyle</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>					<span class=nx>color</span><span class=o>:</span> <span class=nx>theme</span><span class=p>.</span><span class=nx>text</span><span class=p>,</span>
</span></span><span class=line><span class=cl>				<span class=p>},</span>
</span></span><span class=line><span class=cl>			<span class=p>}}</span>
</span></span><span class=line><span class=cl>		<span class=o>&gt;</span>
</span></span><span class=line><span class=cl>			<span class=o>&lt;</span><span class=nx>Stack</span><span class=p>.</span><span class=nx>Screen</span>
</span></span><span class=line><span class=cl>				<span class=nx>name</span><span class=o>=</span><span class=s2>&#34;SearchScreen&#34;</span>
</span></span><span class=line><span class=cl>				<span class=nx>component</span><span class=o>=</span><span class=p>{</span><span class=nx>SearchScreen</span><span class=p>}</span>
</span></span><span class=line><span class=cl>				<span class=nx>options</span><span class=o>=</span><span class=p>{{</span> <span class=nx>headerShown</span><span class=o>:</span> <span class=kc>false</span> <span class=p>}}</span>
</span></span><span class=line><span class=cl>			<span class=o>/&gt;</span>
</span></span><span class=line><span class=cl>			<span class=o>&lt;</span><span class=nx>Stack</span><span class=p>.</span><span class=nx>Screen</span>
</span></span><span class=line><span class=cl>				<span class=nx>name</span><span class=o>=</span><span class=s2>&#34;DetailPage&#34;</span>
</span></span><span class=line><span class=cl>				<span class=nx>component</span><span class=o>=</span><span class=p>{</span><span class=nx>UniversityDetail</span><span class=p>}</span>
</span></span><span class=line><span class=cl>				<span class=nx>options</span><span class=o>=</span><span class=p>{({</span> <span class=nx>route</span> <span class=p>})</span> <span class=p>=&gt;</span> <span class=p>({</span>
</span></span><span class=line><span class=cl>					<span class=nx>title</span><span class=o>:</span> <span class=nx>route</span><span class=p>.</span><span class=nx>params</span><span class=p>.</span><span class=nx>name</span> <span class=o>||</span> <span class=nx>i18n</span><span class=p>.</span><span class=nx>t</span><span class=p>(</span><span class=s1>&#39;university_details&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>				<span class=p>})}</span>
</span></span><span class=line><span class=cl>			<span class=o>/&gt;</span>
</span></span><span class=line><span class=cl>			<span class=o>&lt;</span><span class=nx>Stack</span><span class=p>.</span><span class=nx>Screen</span>
</span></span><span class=line><span class=cl>				<span class=nx>name</span><span class=o>=</span><span class=s2>&#34;UniversitySourceRankingsPage&#34;</span>
</span></span><span class=line><span class=cl>				<span class=nx>component</span><span class=o>=</span><span class=p>{</span><span class=nx>UniversitySourceRankingsPage</span><span class=p>}</span>
</span></span><span class=line><span class=cl>				<span class=nx>options</span><span class=o>=</span><span class=p>{({</span> <span class=nx>route</span> <span class=p>})</span> <span class=p>=&gt;</span> <span class=p>({</span>
</span></span><span class=line><span class=cl>					<span class=nx>title</span><span class=o>:</span> <span class=nx>route</span><span class=p>.</span><span class=nx>params</span><span class=p>.</span><span class=nx>universityName</span> <span class=o>+</span> <span class=s1>&#39; &#39;</span> <span class=o>+</span> <span class=nx>formatSourceName</span><span class=p>(</span><span class=nx>route</span><span class=p>.</span><span class=nx>params</span><span class=p>.</span><span class=nx>source</span><span class=p>),</span>
</span></span><span class=line><span class=cl>				<span class=p>})}</span>
</span></span><span class=line><span class=cl>			<span class=o>/&gt;</span>
</span></span><span class=line><span class=cl>		<span class=o>&lt;</span><span class=err>/Stack.Navigator&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>关键模式</strong>：头部样式是主题感知的。每当用户切换深色模式时，这些颜色实时更新，因为我们从 <code>useTheme()</code> hook 中读取。</p><h3 id=context-provider-组合>Context Provider 组合<a hidden class=anchor aria-hidden=true href=#context-provider-组合>#</a></h3><p>App.js 用 context providers 包装整个导航树：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>AppRoot</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>		<span class=o>&lt;</span><span class=nx>QueryClientProvider</span> <span class=nx>client</span><span class=o>=</span><span class=p>{</span><span class=nx>queryClient</span><span class=p>}</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>			<span class=o>&lt;</span><span class=nx>ThemeProvider</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>				<span class=o>&lt;</span><span class=nx>LanguageProvider</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>					<span class=o>&lt;</span><span class=nx>UniversityTranslationsProvider</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>						<span class=o>&lt;</span><span class=nx>RankingsProvider</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>							<span class=o>&lt;</span><span class=nx>AppContentInner</span> <span class=o>/&gt;</span>
</span></span><span class=line><span class=cl>						<span class=o>&lt;</span><span class=err>/RankingsProvider&gt;</span>
</span></span><span class=line><span class=cl>					<span class=o>&lt;</span><span class=err>/UniversityTranslationsProvider&gt;</span>
</span></span><span class=line><span class=cl>				<span class=o>&lt;</span><span class=err>/LanguageProvider&gt;</span>
</span></span><span class=line><span class=cl>			<span class=o>&lt;</span><span class=err>/ThemeProvider&gt;</span>
</span></span><span class=line><span class=cl>		<span class=o>&lt;</span><span class=err>/QueryClientProvider&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>顺序很重要：</strong></p><ol><li><strong>QueryClientProvider</strong>（最外层）- 管理所有服务器状态</li><li><strong>ThemeProvider</strong> - 为所有组件提供配色方案</li><li><strong>LanguageProvider</strong> - 提供语言和翻译函数</li><li><strong>UniversityTranslationsProvider</strong> - 提供缓存的大学名称翻译</li><li><strong>RankingsProvider</strong> - 为过滤器提供排名选项</li></ol><p>每个 provider 都是独立的，可以单独测试。</p><h2 id=searchscreen实时大学搜索>SearchScreen：实时大学搜索<a hidden class=anchor aria-hidden=true href=#searchscreen实时大学搜索>#</a></h2><p>SearchScreen 是应用中最复杂的组件。它实现了：</p><ul><li>带防抖的实时搜索</li><li>带底部工作表的过滤器选择</li><li>动画加载旋转器</li><li>带平台特定调整的响应式布局</li></ul><h3 id=用-effects-进行数据获取>用 Effects 进行数据获取<a hidden class=anchor aria-hidden=true href=#用-effects-进行数据获取>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=kd>function</span> <span class=nx>SearchScreen</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=p>[</span><span class=nx>query</span><span class=p>,</span> <span class=nx>setQuery</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=p>[</span><span class=nx>country</span><span class=p>,</span> <span class=nx>setCountry</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=p>[</span><span class=nx>sortCredit</span><span class=p>,</span> <span class=nx>setSortCredit</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=s1>&#39;QS_World_University_Rankings&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=p>[</span><span class=nx>results</span><span class=p>,</span> <span class=nx>setResults</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>([]);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=p>[</span><span class=nx>isLoading</span><span class=p>,</span> <span class=nx>setIsLoading</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 当过滤器改变时获取大学
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>useEffect</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nx>isMounted</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>fetchData</span> <span class=o>=</span> <span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>isMounted</span><span class=p>)</span> <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=nx>setIsLoading</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=kr>const</span> <span class=nx>data</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>searchUniversities</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                    <span class=nx>query</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nx>country</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nx>sort_credit</span><span class=o>:</span> <span class=nx>sortCredit</span>
</span></span><span class=line><span class=cl>                <span class=p>});</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>isMounted</span><span class=p>)</span> <span class=k>return</span><span class=p>;</span> <span class=c1>// 如果卸载则不更新
</span></span></span><span class=line><span class=cl><span class=c1></span>                
</span></span><span class=line><span class=cl>                <span class=kr>const</span> <span class=nx>cleaned</span> <span class=o>=</span> <span class=nx>data</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>u</span> <span class=p>=&gt;</span> <span class=p>({</span>
</span></span><span class=line><span class=cl>                    <span class=p>...</span><span class=nx>u</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nx>country</span><span class=o>:</span> <span class=nx>u</span><span class=p>.</span><span class=nx>country</span> <span class=o>||</span> <span class=s1>&#39;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nx>city</span><span class=o>:</span> <span class=nx>u</span><span class=p>.</span><span class=nx>city</span> <span class=o>||</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>                <span class=p>}));</span>
</span></span><span class=line><span class=cl>                <span class=nx>setResults</span><span class=p>(</span><span class=nx>cleaned</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;Error fetching universities:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=nx>isMounted</span><span class=p>)</span> <span class=nx>setResults</span><span class=p>([]);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=k>finally</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=nx>isMounted</span><span class=p>)</span> <span class=nx>setIsLoading</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nx>fetchData</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>isMounted</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span> <span class=c1>// 防止在卸载的组件上更新
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span> <span class=p>[</span><span class=nx>query</span><span class=p>,</span> <span class=nx>country</span><span class=p>,</span> <span class=nx>sortCredit</span><span class=p>]);</span> <span class=c1>// 当过滤器改变时重新运行
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><p><strong>Vibe Coding 模式</strong>：<code>isMounted</code> 标志防止内存泄漏和竞态条件。AI 建议了这个模式，因为：</p><ul><li>导航可以在异步操作完成前卸载屏幕</li><li>没有 <code>isMounted</code>，在卸载的组件上更新状态会导致警告</li><li>这个模式对于 React hooks 是习用的</li></ul><h3 id=用底部工作表模态框进行过滤>用底部工作表模态框进行过滤<a hidden class=anchor aria-hidden=true href=#用底部工作表模态框进行过滤>#</a></h3><p>SearchScreen 使用底部工作表模态框进行国家和排名选择：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>BottomSheetModal</span><span class=p>,</span> <span class=nx>BottomSheetScrollView</span><span class=p>,</span> <span class=nx>BottomSheetBackdrop</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@gorhom/bottom-sheet&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>countrySheetRef</span> <span class=o>=</span> <span class=nx>useRef</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>rankingSheetRef</span> <span class=o>=</span> <span class=nx>useRef</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>snapPoints</span> <span class=o>=</span> <span class=nx>useMemo</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>[</span><span class=s1>&#39;60%&#39;</span><span class=p>,</span> <span class=s1>&#39;75%&#39;</span><span class=p>,</span> <span class=s1>&#39;90%&#39;</span><span class=p>],</span> <span class=p>[]);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 打开国家过滤器
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>handleCountryPress</span> <span class=o>=</span> <span class=nx>useCallback</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>setCountrySearchQuery</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>rankingSheetRef</span><span class=p>.</span><span class=nx>current</span><span class=o>?</span><span class=p>.</span><span class=nx>dismiss</span><span class=p>();</span> <span class=c1>// 关闭其他工作表
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>countrySheetRef</span><span class=p>.</span><span class=nx>current</span><span class=o>?</span><span class=p>.</span><span class=nx>present</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>},</span> <span class=p>[]);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 当用户输入时过滤国家
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>filteredCountryItems</span> <span class=o>=</span> <span class=nx>useMemo</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>countrySearchQuery</span><span class=p>)</span> <span class=k>return</span> <span class=nx>countryItems</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>countryItems</span><span class=p>.</span><span class=nx>filter</span><span class=p>(</span><span class=nx>item</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nx>item</span><span class=p>.</span><span class=nx>label</span><span class=p>.</span><span class=nx>toLowerCase</span><span class=p>().</span><span class=nx>includes</span><span class=p>(</span><span class=nx>countrySearchQuery</span><span class=p>.</span><span class=nx>toLowerCase</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>},</span> <span class=p>[</span><span class=nx>countryItems</span><span class=p>,</span> <span class=nx>countrySearchQuery</span><span class=p>]);</span>
</span></span></code></pre></div><p><strong>关键见解</strong>：底部工作表提供原生般的用户体验，其中过滤器易于访问但不隐藏主要内容。<code>snapPoints</code> 允许用户将工作表拖动到不同的高度。</p><h3 id=搜索结果显示>搜索结果显示<a hidden class=anchor aria-hidden=true href=#搜索结果显示>#</a></h3><p>搜索结果显示在 FlatList 中，用于高效渲染大型列表：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=o>&lt;</span><span class=nx>FlatList</span>
</span></span><span class=line><span class=cl>    <span class=nx>data</span><span class=o>=</span><span class=p>{</span><span class=nx>results</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>keyExtractor</span><span class=o>=</span><span class=p>{(</span><span class=nx>item</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>item</span><span class=p>.</span><span class=nx>normalized_name</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>renderItem</span><span class=o>=</span><span class=p>{({</span> <span class=nx>item</span> <span class=p>})</span> <span class=p>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=nx>TouchableOpacity</span>
</span></span><span class=line><span class=cl>            <span class=nx>onPress</span><span class=o>=</span><span class=p>{()</span> <span class=p>=&gt;</span> <span class=nx>navigation</span><span class=p>.</span><span class=nx>navigate</span><span class=p>(</span><span class=s1>&#39;DetailPage&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>normalized_name</span><span class=o>:</span> <span class=nx>item</span><span class=p>.</span><span class=nx>normalized_name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>name</span><span class=o>:</span> <span class=nx>item</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>country</span><span class=o>:</span> <span class=nx>item</span><span class=p>.</span><span class=nx>country</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=p>})}</span>
</span></span><span class=line><span class=cl>        <span class=o>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=o>&lt;</span><span class=nx>View</span> <span class=nx>style</span><span class=o>=</span><span class=p>{</span><span class=nx>styles</span><span class=p>.</span><span class=nx>resultItem</span><span class=p>}</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=o>&lt;</span><span class=nx>Text</span> <span class=nx>style</span><span class=o>=</span><span class=p>{</span><span class=nx>styles</span><span class=p>.</span><span class=nx>resultName</span><span class=p>}</span><span class=o>&gt;</span><span class=p>{</span><span class=nx>item</span><span class=p>.</span><span class=nx>name</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/Text&gt;</span>
</span></span><span class=line><span class=cl>                <span class=o>&lt;</span><span class=nx>Text</span> <span class=nx>style</span><span class=o>=</span><span class=p>{</span><span class=nx>styles</span><span class=p>.</span><span class=nx>resultLocation</span><span class=p>}</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>{</span><span class=nx>item</span><span class=p>.</span><span class=nx>city</span><span class=p>},</span> <span class=p>{</span><span class=nx>item</span><span class=p>.</span><span class=nx>country</span><span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=o>&lt;</span><span class=err>/Text&gt;</span>
</span></span><span class=line><span class=cl>            <span class=o>&lt;</span><span class=err>/View&gt;</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=err>/TouchableOpacity&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>)}</span>
</span></span><span class=line><span class=cl>    <span class=nx>ListEmptyComponent</span><span class=o>=</span><span class=p>{()</span> <span class=p>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=nx>Text</span> <span class=nx>style</span><span class=o>=</span><span class=p>{</span><span class=nx>styles</span><span class=p>.</span><span class=nx>emptyText</span><span class=p>}</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span><span class=nx>isLoading</span> <span class=o>?</span> <span class=nx>i18n</span><span class=p>.</span><span class=nx>t</span><span class=p>(</span><span class=s1>&#39;searching&#39;</span><span class=p>)</span> <span class=o>:</span> <span class=nx>i18n</span><span class=p>.</span><span class=nx>t</span><span class=p>(</span><span class=s1>&#39;no_results&#39;</span><span class=p>)}</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=err>/Text&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>)}</span>
</span></span><span class=line><span class=cl><span class=err>/&gt;</span>
</span></span></code></pre></div><p><strong>模式</strong>：使用 <code>normalized_name</code> 作为列表键和传递到 DetailPage 的标识符，确保整个应用的一致性。</p><h2 id=detailpage全面的大学资料>DetailPage：全面的大学资料<a hidden class=anchor aria-hidden=true href=#detailpage全面的大学资料>#</a></h2><p>DetailPage 显示：</p><ul><li>大学徽标和基本信息</li><li>跨多个来源的排名</li><li>大学描述（必要时动态翻译）</li><li>收藏/取消收藏功能</li><li>链接到详细排名细节</li></ul><h3 id=异步数据加载>异步数据加载<a hidden class=anchor aria-hidden=true href=#异步数据加载>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=kd>function</span> <span class=nx>GetUniversityDetail</span><span class=p>(</span><span class=nx>props</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>normalized_name</span> <span class=o>=</span> <span class=nx>props</span><span class=p>.</span><span class=nx>route</span><span class=p>.</span><span class=nx>params</span><span class=p>.</span><span class=nx>normalized_name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=p>[</span><span class=nx>university</span><span class=p>,</span> <span class=nx>setUniversity</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=p>[</span><span class=nx>loading</span><span class=p>,</span> <span class=nx>setLoading</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=p>[</span><span class=nx>translatedBlurb</span><span class=p>,</span> <span class=nx>setTranslatedBlurb</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=p>[</span><span class=nx>translationLoading</span><span class=p>,</span> <span class=nx>setTranslationLoading</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=p>{</span> <span class=nx>isChinese</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>useLanguage</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 获取大学详情
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>useEffect</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>normalized_name</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>getUniversityDetails</span><span class=p>(</span><span class=nx>normalized_name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>data</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>notFound</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nx>navigation</span><span class=p>.</span><span class=nx>goBack</span><span class=p>();</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nx>setUniversity</span><span class=p>(</span><span class=nx>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                        <span class=nx>setLoading</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                        <span class=nx>checkIfFavorite</span><span class=p>(</span><span class=nx>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>})</span>
</span></span><span class=line><span class=cl>                <span class=p>.</span><span class=k>catch</span><span class=p>(</span><span class=nx>err</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;Error fetching details:&#39;</span><span class=p>,</span> <span class=nx>err</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=nx>setLoading</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span> <span class=p>[</span><span class=nx>normalized_name</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 当语言改变时翻译描述
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>useEffect</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nx>isMounted</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>translateBlurbIfNeeded</span> <span class=o>=</span> <span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=nx>university</span> <span class=o>&amp;&amp;</span> <span class=nx>university</span><span class=p>.</span><span class=nx>blurb</span> <span class=o>&amp;&amp;</span> <span class=nx>isChinese</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>setTranslationLoading</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=kr>const</span> <span class=nx>translated</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>translateText</span><span class=p>(</span><span class=nx>university</span><span class=p>.</span><span class=nx>blurb</span><span class=p>,</span> <span class=s1>&#39;en&#39;</span><span class=p>,</span> <span class=s1>&#39;zh-Hans&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=p>(</span><span class=nx>isMounted</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nx>setTranslatedBlurb</span><span class=p>(</span><span class=nx>translated</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;Translation failed:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=nx>isMounted</span><span class=p>)</span> <span class=nx>setTranslatedBlurb</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nx>translateBlurbIfNeeded</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span> <span class=nx>isMounted</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span> <span class=p>[</span><span class=nx>university</span><span class=p>,</span> <span class=nx>isChinese</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>关键模式</strong>：翻译作为副作用处理，当语言上下文改变时。这保持了翻译逻辑与组件渲染分离。</p><h3 id=用-asyncstorage-管理收藏>用 AsyncStorage 管理收藏<a hidden class=anchor aria-hidden=true href=#用-asyncstorage-管理收藏>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>checkIfFavorite</span> <span class=o>=</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>universityData</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>stored</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>AsyncStorage</span><span class=p>.</span><span class=nx>getItem</span><span class=p>(</span><span class=s1>&#39;favoriteUniversities&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>stored</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>favorites</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>stored</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>isCurrentFavorite</span> <span class=o>=</span> <span class=nx>favorites</span><span class=p>.</span><span class=nx>some</span><span class=p>(</span><span class=nx>fav</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nx>fav</span><span class=p>.</span><span class=nx>normalized_name</span> <span class=o>===</span> <span class=nx>universityData</span><span class=p>.</span><span class=nx>normalized_name</span> <span class=o>||</span>
</span></span><span class=line><span class=cl>                <span class=nx>fav</span><span class=p>.</span><span class=nx>id</span> <span class=o>===</span> <span class=nx>universityData</span><span class=p>.</span><span class=nx>id</span>
</span></span><span class=line><span class=cl>            <span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nx>setIsFavorite</span><span class=p>(</span><span class=nx>isCurrentFavorite</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;Error checking favorites:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>toggleFavorite</span> <span class=o>=</span> <span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>university</span><span class=p>)</span> <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>setFavoriteLoading</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>stored</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>AsyncStorage</span><span class=p>.</span><span class=nx>getItem</span><span class=p>(</span><span class=s1>&#39;favoriteUniversities&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nx>favorites</span> <span class=o>=</span> <span class=nx>stored</span> <span class=o>?</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>stored</span><span class=p>)</span> <span class=o>:</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>favoriteData</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>id</span><span class=o>:</span> <span class=nx>university</span><span class=p>.</span><span class=nx>id</span> <span class=o>||</span> <span class=nx>university</span><span class=p>.</span><span class=nx>normalized_name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>normalized_name</span><span class=o>:</span> <span class=nx>university</span><span class=p>.</span><span class=nx>normalized_name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>name</span><span class=o>:</span> <span class=nx>university</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>country</span><span class=o>:</span> <span class=nx>university</span><span class=p>.</span><span class=nx>country</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>city</span><span class=o>:</span> <span class=nx>university</span><span class=p>.</span><span class=nx>city</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>photo</span><span class=o>:</span> <span class=nx>university</span><span class=p>.</span><span class=nx>photo</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>isFavorite</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// 从收藏中删除
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nx>favorites</span> <span class=o>=</span> <span class=nx>favorites</span><span class=p>.</span><span class=nx>filter</span><span class=p>(</span><span class=nx>fav</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nx>fav</span><span class=p>.</span><span class=nx>normalized_name</span> <span class=o>!==</span> <span class=nx>university</span><span class=p>.</span><span class=nx>normalized_name</span> <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=cl>                <span class=nx>fav</span><span class=p>.</span><span class=nx>id</span> <span class=o>!==</span> <span class=nx>university</span><span class=p>.</span><span class=nx>id</span>
</span></span><span class=line><span class=cl>            <span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nx>setIsFavorite</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// 添加到收藏
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nx>favorites</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>favoriteData</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nx>setIsFavorite</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=nx>AsyncStorage</span><span class=p>.</span><span class=nx>setItem</span><span class=p>(</span><span class=s1>&#39;favoriteUniversities&#39;</span><span class=p>,</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>favorites</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=nx>updateFavoriteCount</span><span class=p>(</span><span class=nx>favorites</span><span class=p>.</span><span class=nx>length</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;Error updating favorites:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>finally</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>setFavoriteLoading</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><p><strong>Vibe Coding 见解</strong>：与其向后端同步收藏，我们用 AsyncStorage 本地存储它们。这提供了：</p><ul><li>即时反馈（无网络延迟）</li><li>离线工作</li><li>减少服务器负载</li></ul><p><code>favoriteLoading</code> 状态确保 UI 在切换操作期间显示加载状态。</p><h2 id=api-集成libapijs-层>API 集成：lib/api.js 层<a hidden class=anchor aria-hidden=true href=#api-集成libapijs-层>#</a></h2><p>API 层将 API 调用与组件分离：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>API_BASE_URL</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;../constants/config&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>axios</span> <span class=nx>from</span> <span class=s1>&#39;axios&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>rawApi</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>searchUniversities</span><span class=p>({</span> <span class=nx>query</span><span class=p>,</span> <span class=nx>country</span><span class=p>,</span> <span class=nx>city</span><span class=p>,</span> <span class=nx>sort_credit</span> <span class=p>})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>response</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>axios</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=nx>API_BASE_URL</span><span class=si>}</span><span class=sb>/universities/filter`</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>params</span><span class=o>:</span> <span class=p>{</span> <span class=nx>query</span><span class=p>,</span> <span class=nx>country</span><span class=p>,</span> <span class=nx>city</span><span class=p>,</span> <span class=nx>sort_credit</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>response</span><span class=p>.</span><span class=nx>data</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>getUniversityDetails</span><span class=p>(</span><span class=nx>normalizedName</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>response</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>axios</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=nx>API_BASE_URL</span><span class=si>}</span><span class=sb>/universities/</span><span class=si>${</span><span class=nx>normalizedName</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>response</span><span class=p>.</span><span class=nx>status</span> <span class=o>!==</span> <span class=mi>200</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=sb>`Failed to fetch: </span><span class=si>${</span><span class=nx>response</span><span class=p>.</span><span class=nx>status</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>response</span><span class=p>.</span><span class=nx>data</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>translateText</span><span class=p>(</span><span class=nx>text</span><span class=p>,</span> <span class=nx>from</span><span class=p>,</span> <span class=nx>to</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>response</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>axios</span><span class=p>.</span><span class=nx>post</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=nx>API_BASE_URL</span><span class=si>}</span><span class=sb>/translate`</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>text</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>from_lang</span><span class=o>:</span> <span class=nx>from</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>to_lang</span><span class=o>:</span> <span class=nx>to</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>response</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>translatedText</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 导出函数供直接使用
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>export</span> <span class=kr>const</span> <span class=nx>searchUniversities</span> <span class=o>=</span> <span class=nx>rawApi</span><span class=p>.</span><span class=nx>searchUniversities</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=nx>getUniversityDetails</span> <span class=o>=</span> <span class=nx>rawApi</span><span class=p>.</span><span class=nx>getUniversityDetails</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=nx>translateText</span> <span class=o>=</span> <span class=nx>rawApi</span><span class=p>.</span><span class=nx>translateText</span><span class=p>;</span>
</span></span></code></pre></div><p><strong>这个模式的好处：</strong></p><ul><li><strong>可测试性</strong>：易于为单元测试模拟 <code>rawApi</code></li><li><strong>可重用性</strong>：API 函数可以直接使用或用 React Query 包装</li><li><strong>可维护性</strong>：所有 API 调用在一个地方</li></ul><h2 id=从-vibe-coding-得到的设计见解>从 Vibe Coding 得到的设计见解<a hidden class=anchor aria-hidden=true href=#从-vibe-coding-得到的设计见解>#</a></h2><h3 id=1-实时搜索比防抖更简单>1. 实时搜索比防抖更简单<a hidden class=anchor aria-hidden=true href=#1-实时搜索比防抖更简单>#</a></h3><p>最初，防抖搜索似乎是必需的以减少 API 调用。然而，后端过滤端点很快，网络很可靠。所以我们跳过防抖并让用户看到即时结果。<strong>这是 Vibe Coding</strong>：务实的选择优于理论上的优化。</p><h3 id=2-底部工作表--模态对话框>2. 底部工作表 > 模态对话框<a hidden class=anchor aria-hidden=true href=#2-底部工作表--模态对话框>#</a></h3><p>原生般的底部工作表提供比居中模态框更好的用户体验，因为：</p><ul><li>用户可以看到工作表后的内容</li><li>拖动关闭感觉自然</li><li>屏幕空间使用高效</li></ul><p>AI 建议 <code>@gorhom/bottom-sheet</code>，因为它提供平滑的动画和手势处理。</p><h3 id=3-context--asyncstorage--用于偏好的-redux>3. Context + AsyncStorage > 用于偏好的 Redux<a hidden class=anchor aria-hidden=true href=#3-context--asyncstorage--用于偏好的-redux>#</a></h3><p>用 AsyncStorage 和 React Context 本地管理收藏比以下更简单：</p><ul><li>Redux + Redux Persist</li><li>同步到后端</li><li>复杂的状态管理</li></ul><p>Vibe Coding 帮助我们认识到并非所有内容都需要在全局状态中。</p><h2 id=总结>总结<a hidden class=anchor aria-hidden=true href=#总结>#</a></h2><p>在第一部分中，我们探索了：</p><ul><li>✅ 导航如何在 App.js 中用底部标签和堆栈导航器编排</li><li>✅ 用实时过滤和底部工作表模态框构建 SearchScreen</li><li>✅ 实现具有异步数据加载和收藏管理的 DetailPage</li><li>✅ 为可重用性和可测试性构造 API 调用</li></ul><p>在 https://xiaruize.org/zh/post/university-ranking-frontend-part-2/ 中，我们将深入探讨：</p><ul><li>Context 实现细节（ThemeContext、LanguageContext、RankingsProvider）</li><li>React Query 用于复杂数据管理的模式</li><li>主题感知 UI 的组件样式模式</li><li>平台特定的考虑因素</li></ul><p>关键要点：<strong>好的导航架构启用干净的组件设计</strong>。通过在 App.js 中处理导航问题，单个屏幕可以专注于其特定职责——搜索、显示和管理数据。</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://xiaruize.org/zh/tags/react-native/>React Native</a></li><li><a href=https://xiaruize.org/zh/tags/%E5%AF%BC%E8%88%AA/>导航</a></li><li><a href=https://xiaruize.org/zh/tags/%E6%90%9C%E7%B4%A2/>搜索</a></li><li><a href=https://xiaruize.org/zh/tags/vibe-coding/>Vibe Coding</a></li><li><a href=https://xiaruize.org/zh/tags/%E5%AE%9E%E7%8E%B0/>实现</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://xiaruize.org/zh/>xiaruize's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>